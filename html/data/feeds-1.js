{"feeds":[{"id":"3","name":"Ayende @ Rahien"},{"id":"1","name":"Linus' blog"},{"id":"2","name":"Seth's Blog"}],"list":[{"id":"1","feed_id":"3","title":"Reviewing LevelDB: Part II, Put some data on the disk, dude","date":"2013-03-21 10:00:00","body":"<p>I think that the very first thing that we want to do is to actually discover how exactly is leveldb saving the information to disk. In order to do that, we are going to trace the calls (with commentary) for the Put method.</p> <p>We start from the client code:</p> <blockquote> <div id=\"codeSnippetWrapper\"> <div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> leveldb::DB* db;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span> leveldb::DB::Open(options, <span style=\"color: #006080\">\"play/testdb\"</span>, &amp;db);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span> status = db-&gt;Put(leveldb::WriteOptions(), <span style=\"color: #006080\">\"Key\"</span>, <span style=\"color: #006080\">\"Hello World\"</span>);</pre><!--CRLF--></div></div></blockquote>\n<p>This calls the following method:</p>\n<blockquote>\n<div id=\"codeSnippetWrapper\">\n<div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> <span style=\"color: #008000\">// Default implementations of convenience methods that subclasses of DB</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span> <span style=\"color: #008000\">// can call if they wish</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span> Status DB::Put(<span style=\"color: #0000ff\">const</span> WriteOptions&amp; opt, <span style=\"color: #0000ff\">const</span> Slice&amp; key, <span style=\"color: #0000ff\">const</span> Slice&amp; value) {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum4\">   4:</span>   WriteBatch batch;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum5\">   5:</span>   batch.Put(key, value);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum6\">   6:</span>   <span style=\"color: #0000ff\">return</span> Write(opt, &amp;batch);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum7\">   7:</span> }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum8\">   8:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum9\">   9:</span> Status DB::Delete(<span style=\"color: #0000ff\">const</span> WriteOptions&amp; opt, <span style=\"color: #0000ff\">const</span> Slice&amp; key) {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum10\">  10:</span>   WriteBatch batch;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum11\">  11:</span>   batch.Delete(key);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum12\">  12:</span>   <span style=\"color: #0000ff\">return</span> Write(opt, &amp;batch);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum13\">  13:</span> }</pre><!--CRLF--></div></div></blockquote>\n<p>I included the Delete method as well, because this code teaches us something important, all the modifications calls are always going through the same WriteBatch call. Let us look at that now.</p>\n<blockquote>\n<div id=\"codeSnippetWrapper\">\n<div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> Status DBImpl::Write(<span style=\"color: #0000ff\">const</span> WriteOptions&amp; options, WriteBatch* my_batch) {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span>   Writer w(&amp;mutex_);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span>   w.batch = my_batch;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum4\">   4:</span>   w.sync = options.sync;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum5\">   5:</span>   w.done = false;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum6\">   6:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum7\">   7:</span>   MutexLock l(&amp;mutex_);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum8\">   8:</span>   writers_.push_back(&amp;w);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum9\">   9:</span>   <span style=\"color: #0000ff\">while</span> (!w.done &amp;&amp; &amp;w != writers_.front()) {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum10\">  10:</span>     w.cv.Wait();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum11\">  11:</span>   }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum12\">  12:</span>   <span style=\"color: #0000ff\">if</span> (w.done) {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum13\">  13:</span>     <span style=\"color: #0000ff\">return</span> w.status;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum14\">  14:</span>   }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum15\">  15:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum16\">  16:</span>   <span style=\"color: #008000\">// May temporarily unlock and wait.</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum17\">  17:</span>   Status status = MakeRoomForWrite(my_batch == NULL);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum18\">  18:</span>   uint64_t last_sequence = versions_-&gt;LastSequence();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum19\">  19:</span>   Writer* last_writer = &amp;w;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum20\">  20:</span>   <span style=\"color: #0000ff\">if</span> (status.ok() &amp;&amp; my_batch != NULL) {  <span style=\"color: #008000\">// NULL batch is for compactions</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum21\">  21:</span>     WriteBatch* updates = BuildBatchGroup(&amp;last_writer);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum22\">  22:</span>     WriteBatchInternal::SetSequence(updates, last_sequence + 1);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum23\">  23:</span>     last_sequence += WriteBatchInternal::Count(updates);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum24\">  24:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum25\">  25:</span>     <span style=\"color: #008000\">// Add to log and apply to memtable.  We can release the lock</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum26\">  26:</span>     <span style=\"color: #008000\">// during this phase since &amp;w is currently responsible for logging</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum27\">  27:</span>     <span style=\"color: #008000\">// and protects against concurrent loggers and concurrent writes</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum28\">  28:</span>     <span style=\"color: #008000\">// into mem_.</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum29\">  29:</span>     {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum30\">  30:</span>       mutex_.Unlock();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum31\">  31:</span>       status = log_-&gt;AddRecord(WriteBatchInternal::Contents(updates));</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum32\">  32:</span>       <span style=\"color: #0000ff\">if</span> (status.ok() &amp;&amp; options.sync) {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum33\">  33:</span>         status = logfile_-&gt;Sync();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum34\">  34:</span>       }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum35\">  35:</span>       <span style=\"color: #0000ff\">if</span> (status.ok()) {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum36\">  36:</span>         status = WriteBatchInternal::InsertInto(updates, mem_);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum37\">  37:</span>       }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum38\">  38:</span>       mutex_.Lock();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum39\">  39:</span>     }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum40\">  40:</span>     <span style=\"color: #0000ff\">if</span> (updates == tmp_batch_) tmp_batch_-&gt;Clear();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum41\">  41:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum42\">  42:</span>     versions_-&gt;SetLastSequence(last_sequence);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum43\">  43:</span>   }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum44\">  44:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum45\">  45:</span>   <span style=\"color: #0000ff\">while</span> (true) {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum46\">  46:</span>     Writer* ready = writers_.front();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum47\">  47:</span>     writers_.pop_front();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum48\">  48:</span>     <span style=\"color: #0000ff\">if</span> (ready != &amp;w) {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum49\">  49:</span>       ready-&gt;status = status;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum50\">  50:</span>       ready-&gt;done = true;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum51\">  51:</span>       ready-&gt;cv.Signal();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum52\">  52:</span>     }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum53\">  53:</span>     <span style=\"color: #0000ff\">if</span> (ready == last_writer) <span style=\"color: #0000ff\">break</span>;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum54\">  54:</span>   }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum55\">  55:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum56\">  56:</span>   <span style=\"color: #008000\">// Notify new head of write queue</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum57\">  57:</span>   <span style=\"color: #0000ff\">if</span> (!writers_.empty()) {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum58\">  58:</span>     writers_.front()-&gt;cv.Signal();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum59\">  59:</span>   }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum60\">  60:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum61\">  61:</span>   <span style=\"color: #0000ff\">return</span> status;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum62\">  62:</span> }</pre><!--CRLF--></div></div></blockquote>\n<p>Now we have a <em>lot</em> of code to go through. Let us see what conclusions we can draw from this.</p>\n<p>The first 15 lines or so seems to create a new Writer, not sure what that is yet, and register that in a class variable. Maybe it is actually being written on a separate thread?</p>\n<p>I am going to switch over and look at that line of thinking .First thing to do is to look at the Writer implementation. This writer looks like this:</p>\n<blockquote>\n<div id=\"codeSnippetWrapper\">\n<div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> <span style=\"color: #0000ff\">struct</span> DBImpl::Writer {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span>   Status status;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span>   WriteBatch* batch;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum4\">   4:</span>   <span style=\"color: #0000ff\">bool</span> sync;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum5\">   5:</span>   <span style=\"color: #0000ff\">bool</span> done;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum6\">   6:</span>   port::CondVar cv;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum7\">   7:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum8\">   8:</span>   <span style=\"color: #0000ff\">explicit</span> Writer(port::Mutex* mu) : cv(mu) { }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum9\">   9:</span> };</pre><!--CRLF--></div></div></blockquote>\n<p>So this is just a data structure with no behavior. Note that we have CondVar, whatever that is. Which accepts a mutex. Following the code, we see this is a pthread condition variable. I haven’t dug too deep into this, but it appears like it is similar to the .NET lock variable. Except that there seems to be the ability to associate multiple variables with a single mutex. Which could be a useful way to signal on specific conditions. The basic idea is that you can wait for a specific operation, not just a single variable.</p>\n<p>Now that I get that, let us see what we can figure out about the writers_ usage. This is just a standard (non thread safe) std::deque, (a data structure merging properties of list &amp; queue). Thread safety is achieved via the call to MutexLock on line 7. I am going to continue ignoring the rest of the function and look where else this value is being used now. Back now, and it appears that the only place where writers_ are used in in this method or methods that it calls.</p>\n<p>What this means in turn is that unlike what I thought, there isn’t a dedicated background thread for this operation. Rather, this is a way for leveldb to serialize access. As I understand it. Calls to the Write() method would block on the mutex access, then it waits until <em>its</em> write is the current one (that is what the &amp;w != writers_.front() means. Although the code also seems to suggest that another thread may pick up on this behavior and batch multiple writes to disk at the same time. We will discuss this later on.</p>\n<p>Right now, let us move to line 17, and MakeRoomForWrite. This appears to try to make sure that we have enough room to the next write. I don’t really follow the code there yet, I’ll ignore that for now and move on to the rest of the Write() method.</p>\n<p>In line 18, we get the current sequence number, although I am not sure why that is, I think it is possible this is for the log. The next interesting bit is in BuildBatchGroup, this method will merge existing pending writes into one big write (but not <em>too</em> big a write). This is a really nice way to merge a lot of IO into a single disk access, without introducing latency in the common case.</p>\n<p>The rest of the code is dealing with the actual write to the log&nbsp; / mem table 20 – 45, then updating the status of the other writers we might have modified, as well as starting the writes for existing writers that may have not got into the current batch.</p>\n<p>And I think that this is enough for now. We haven’t got to disk yet, I admit, but we did get a lot of stuff done. On my next post, I’ll dig even deeper, and try to see how the data is actually structured, I think that this would be interesting…</p>","read":"0"},{"id":"2","feed_id":"3","title":"RavenDB vNext: It is so pink!","date":"2013-03-21 08:16:00","body":"<p>Just thought that you might appreciate a peek into what we have been working on:</p> <p><a href=\"http://ayende.com/blog/Images/Windows-Live-Writer/RavenDB-vNext-It-is-so-pink_ACB6/image_2.png\"><img style=\"background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/RavenDB-vNext-It-is-so-pink_ACB6/image_thumb.png\" width=\"513\" height=\"402\"></a></p> <p>You can consider the bright pink background a bug, by the way. But the installer is real, and it will guide you through an install of RavenDB using the “Yes, Dear” model.</p> <p>This is mostly for clients that don’t like xcopy installs (honestly, this is to make sure that setting up in IIS is no longer a set of manual steps).</p>","read":"0"},{"id":"3","feed_id":"3","title":"Reviewing LevelDB, Part I: What is this all about?","date":"2013-03-20 10:00:00","body":"<p><a href=\"http://code.google.com/p/leveldb/\">LevelDB</a> is…</p> <blockquote> <p><strong>a fast key-value storage library written at Google that provides an ordered mapping from string keys to string values.</strong></p></blockquote> <p>That is the project’s own definition. Basically, it is a way for users to store data in an efficient manner. It isn’t a SQL database. It isn’t even a real database in any sense of the word. What it is is a <em>building</em> block for building databases. It handles writing and reading to disk, and it supports atomicity. But anything else is on you (from transaction management to more complex items). <p>As such, it appears perfect for the kind of things that we need to do. I decided that I wanted to get to know the codebase, especially since at this time, I can’t even get it to compile <img style=\"border-bottom-style: none; border-left-style: none; border-top-style: none; border-right-style: none\" class=\"wlEmoticon wlEmoticon-sadsmile\" alt=\"Sad smile\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/Reviewing-LevelDB-Part-I-What-is-this-al_87BA/wlEmoticon-sadsmile_2.png\">. The fact that this is a C++ codebase, written by people who eat &amp; breath C++ for a living is another reason why. I expect that this would be a <em>good</em> codebase, so I might as well sharpen my C++-foo at the same time that I grok what this is doing. <p>The first thing to do is to look at the interface that the database provides us with: <blockquote> <p><a href=\"http://ayende.com/blog/Images/Windows-Live-Writer/Reviewing-LevelDB-Part-I-What-is-this-al_87BA/image_4.png\"><img style=\"background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/Reviewing-LevelDB-Part-I-What-is-this-al_87BA/image_thumb_1.png\" width=\"427\" height=\"303\"></a></p></blockquote> <p>That is a <em>very</em> small surface area, and as you can imagine, this is something that I highly approve of. It make it much easier to understand and reason about. And there is some pretty complex behavior behind this, which I’ll be exploring soon.</p>","read":"0"},{"id":"4","feed_id":"3","title":"RavenDB vNext? Just the same, a little bit better, all over the place","date":"2013-03-19 10:00:00","body":"<p>We pretty much completed all of the major work that was going to get into the next major RavenDB release. There is the indexing stuff that I already talked about in this blog, but most of the rest are a lot of seemingly minor things. Nothing that would blow you head in isolation.</p> <p>Things like better aggressive caching invalidation, faster error in network timeout scenarios, better bucket selection algorithm for map/reduce, providing you with auto resolving conflicts, or even more improvements to the studio.</p> <p>Hell, it is even things like this:</p> <p><a href=\"http://ayende.com/blog/Images/Windows-Live-Writer/RavenDB-vNext-Just-the-same-a-little-bit_ADC9/image_2.png\"><img style=\"background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/RavenDB-vNext-Just-the-same-a-little-bit_ADC9/image_thumb.png\" width=\"524\" height=\"523\"></a></p> <p>We output a <em>lot</em> of information that can help you figure out what is going on in your system. But now we are actually starting to take it up a notch and also provide good UX for handling that.</p>","read":"0"},{"id":"21","feed_id":"2","title":"Pitch your tent where it's dry","date":"2013-03-19 05:56:00","body":"<div xmlns=\"http://www.w3.org/1999/xhtml\"><p>Silly question: Does it snow in Utah because that's where they built the ski areas?</p>\r\n<p>Of course not. It's obvious that you find the snow and then you build the ski runs.</p>\r\n<p>Years ago, a friend was frustrated by the fact that the toy industry wouldn't license her fabulous ideas for new products. She rarely got meetings, was often disrespected and couldn't make anything happen. In a situation like that, it's easy to question the ideas themselves, and to doubt the quality of the work. When I pointed out to her that the toy business actually has a long and dismal history of acquiring and promoting new ideas, she switched--and the book industry (which publishes thousands of new projects every month) opened the door and the market made her a (huge, and deserved) success.</p>\r\n<p>Whether you're a non-profit fundraiser or someone selling b2b, understanding the profile of what's succeeded before you is a little like understanding where it snows. Sure, it's possible to invent an entirely new market dynamic, to persuade the previously unpersuadable. If that's your mission, go for it. But if your goal is to make your project work, to engage in a way that makes a difference right now, you're better off planting seeds in fertile soil.</p>\r\n<p>Insisting that you're \"right\" isn't nearly as effective as building your organization in a place that's conducive to what you're trying to accomplish. Right is meaningless if it doesn't lead to a connection, and complaining about a wet sleeping bag gets you no sympathy.</p></div><div class=\"feedflare\">\n<a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=GncOdqpWlzo:FGYGch61Gu0:yIl2AUoC8zA\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=yIl2AUoC8zA\" border=\"0\"></img></a> <a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=GncOdqpWlzo:FGYGch61Gu0:qj6IDK7rITs\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=qj6IDK7rITs\" border=\"0\"></img></a>\n</div><img src=\"http://feeds.feedburner.com/~r/typepad/sethsmainblog/~4/GncOdqpWlzo\" height=\"1\" width=\"1\"/>","read":"0"},{"id":"5","feed_id":"3","title":"test","date":"2013-03-18 14:27:54","body":"<p>\n\ttest</p>\n","read":"0"},{"id":"6","feed_id":"3","title":"Aggressive caching: Pacified","date":"2013-03-18 10:00:00","body":"<p><img style=\"display: inline; float: right\" align=\"right\" src=\"http://arolemodel.com/wp-content/uploads/2013/01/Our-Online-Anger-Manegement-Test-Are-You-Passive-Aggressive-300x232.jpg\"></p> <p>RavenDB’s <a href=\"http://ayende.com/blog/25601/ravendb-aggressive-caching-mode\">aggressive caching</a> allows RavenDB Clients to skip going to the server and&nbsp; serve requests directly off the client cache. That means that you can answer queries <em>very</em>&nbsp; quickly, because you never even have to leave your process memory space.</p> <p>The downside to that was, of course, that you might be showing information that have changed behind your back.</p> <p>That is why we usually wrote aggressive caching code like this:</p> <blockquote><pre class=\"csharpcode\"><span class=\"kwrd\">using</span> (session.Advanced.DocumentStore.AggressivelyCacheFor(TimeSpan.FromMinutes(5)))\n{\n   var user =  session.Load&lt;User&gt;(<span class=\"str\">\"users/1\"</span>);\n   Console.WriteLine(user.Name);\n}</pre>\n<style type=\"text/css\">.csharpcode, .csharpcode pre\n{\n\tfont-size: small;\n\tcolor: black;\n\tfont-family: consolas, \"Courier New\", courier, monospace;\n\tbackground-color: #ffffff;\n\t/*white-space: pre;*/\n}\n.csharpcode pre { margin: 0em; }\n.csharpcode .rem { color: #008000; }\n.csharpcode .kwrd { color: #0000ff; }\n.csharpcode .str { color: #006080; }\n.csharpcode .op { color: #0000c0; }\n.csharpcode .preproc { color: #cc6633; }\n.csharpcode .asp { background-color: #ffff00; }\n.csharpcode .html { color: #800000; }\n.csharpcode .attr { color: #ff0000; }\n.csharpcode .alt \n{\n\tbackground-color: #f4f4f4;\n\twidth: 100%;\n\tmargin: 0em;\n}\n.csharpcode .lnum { color: #606060; }\n</style>\n</blockquote>\n<p>We gave it some duration in which it was okay to skip going to the server. So we had a maximum of 5 minutes when we had the cached information in place.</p>\n<p>That was nice, but it was awkward. And not really nice thing to do in general. In particular, it meant that you had to wait 5 minutes for things to actually show up in the application. That can be... frustrating, because it looks like the system isn’t really doing something. On the other hand, it also means that you still have to query the server when the duration is over, and by necessity, the durations are relatively short.</p>\n<p>We decided to change that. Now, when you are using aggressive caching, RavenDB will automatically subscribe to changes from the server. When that happens, we will be able to use the notifications to know when we need to re-check on the server.</p>\n<p>That means that you can set an aggressive cache duration of much longer period, and that we will know, automatically and without you needing to do anything.</p>\n<p>It is a small touch, but an important one. Things just get better <img style=\"border-bottom-style: none; border-left-style: none; border-top-style: none; border-right-style: none\" class=\"wlEmoticon wlEmoticon-smile\" alt=\"Smile\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/Aggressive-caching-Pacified_AFC6/wlEmoticon-smile_2.png\">.</p>","read":"0"},{"id":"22","feed_id":"2","title":"Communication is a path, not an event","date":"2013-03-18 07:09:12","body":"<div xmlns=\"http://www.w3.org/1999/xhtml\"><p>The other day, I heard the CEO of a large corporation drone on for twenty minutes. He was pitching a large group of strangers, reading them a long, prepared speech that was largely irrelevant to their needs. They weren't there to hear him and in fact, weren't even able to hear him over the buzz in their heads... this was classic interruption, no permission granted. </p>\r\n<p>If you'd interviewed the 150 people in the room an hour later, no one could have told you a single thing about what he had said.</p>\r\n<p>If your tactic is to have a one-shot, the equivalent of a pickup line in a singles' bar, it's pretty hopeless. You can't sell anything complex or risky in this way.</p>\r\n<p>On the other hand, what if he had taken three minutes (just three) to say, \"Let's talk.\" Give out his personal contact info or an easy way (and a good reason!) to engage with his staff. And then give up the podium and let the event go forward.</p>\r\n<p>Don't sell us anything but the burning desire to follow up. The point of his talk wasn't to get a new customer (impossible), nor was it to get through the talk and get it over with (silly and selfish). No, the point of the talk should have been to open the door to have a better, individual conversation soon.</p>\r\n<p>\"Let's talk,\" uses today's interaction to make it more likely you have one tomorrow. And a dialogue leads to connection, which leads to trust which leads to engagement.</p>\r\n<p>Yes, it's surprisingly difficult in today's oversaturated communications world to succeed even with an offer of \"let's talk,\" but it's demonstrably better than the alternative.</p>\r\n<p>Drip, drip, drip.</p></div><div class=\"feedflare\">\n<a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=5zAxTd_rr0E:Q5K74h26EA0:yIl2AUoC8zA\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=yIl2AUoC8zA\" border=\"0\"></img></a> <a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=5zAxTd_rr0E:Q5K74h26EA0:qj6IDK7rITs\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=qj6IDK7rITs\" border=\"0\"></img></a>\n</div><img src=\"http://feeds.feedburner.com/~r/typepad/sethsmainblog/~4/5zAxTd_rr0E\" height=\"1\" width=\"1\"/>","read":"0"},{"id":"23","feed_id":"2","title":"On feeling small","date":"2013-03-17 05:32:00","body":"<div xmlns=\"http://www.w3.org/1999/xhtml\"><p style=\"padding-left: 30px;\">\"To make us feel small in the right way is a function of art; men can only make us feel small in the wrong way.\" E. M. Forster</p>\r\n<p>The small feeling produced by art comes from dancing with our muse and allowing our inspiration to take us somewhere the resistance would rather avoid. We feel small in the face of magic and connection. Feeling small gives us the guts to create something bigger, bigger than ourselves, the art of human connection and the gift of generosity.</p>\r\n<p>On the other hand, the critic who seeks to beef himself up at our expense diminishes no one but himself.</p></div><div class=\"feedflare\">\n<a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=08RpKOwNbQY:CNZ3Qj6eVj4:yIl2AUoC8zA\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=yIl2AUoC8zA\" border=\"0\"></img></a> <a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=08RpKOwNbQY:CNZ3Qj6eVj4:qj6IDK7rITs\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=qj6IDK7rITs\" border=\"0\"></img></a>\n</div><img src=\"http://feeds.feedburner.com/~r/typepad/sethsmainblog/~4/08RpKOwNbQY\" height=\"1\" width=\"1\"/>","read":"0"},{"id":"24","feed_id":"2","title":"Important, not very good, could get a lot better","date":"2013-03-16 05:06:00","body":"<div xmlns=\"http://www.w3.org/1999/xhtml\"><p>A recipe for personal and brand triage...</p>\r\n<p>We invest our time in hopes of a return, prioritizing the important, but sometimes, we waste it on the urgent instead.</p>\r\n<p>What's worth focusing on improving? How about a combination of these three:</p>\r\n<ul>\r\n<li>The important</li>\r\n<li>That you currently don't do very well</li>\r\n<li>That you're capable of doing a lot better if you invested effort and time</li>\r\n</ul>\r\n<p>Eliminate the things that don't matter, that you're never going to get better at or that you're already good at. What's left are the places where you have the opportunity to change your position in the market.</p></div><div class=\"feedflare\">\n<a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=1m7baejT4Ro:du1qWXHjz2w:yIl2AUoC8zA\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=yIl2AUoC8zA\" border=\"0\"></img></a> <a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=1m7baejT4Ro:du1qWXHjz2w:qj6IDK7rITs\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=qj6IDK7rITs\" border=\"0\"></img></a>\n</div><img src=\"http://feeds.feedburner.com/~r/typepad/sethsmainblog/~4/1m7baejT4Ro\" height=\"1\" width=\"1\"/>","read":"0"},{"id":"7","feed_id":"3","title":"RavenDB and storing large number of entities types in a single database","date":"2013-03-15 10:00:00","body":"<p>By default, we expect to have a rather smaller number of entities types in a database. Unlike relational databases, where you typically see hundreds or thousands of tables, because everything gets dumped into a single database (and because a single document in RavenDB typically reside in many relational tables).</p> <p>That said, we got a few complaints about this story, because the studio UI becomes hard to use when this happens. We decided to support it in an interesting fashion. This is what your documents will look like when you have ~60 entities types in a single database:</p> <p><a href=\"http://ayende.com/blog/Images/Windows-Live-Writer/RavenDB-large-number-of_9B5F/collcections.png\"><img style=\"background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px\" title=\"collcections\" border=\"0\" alt=\"collcections\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/RavenDB-large-number-of_9B5F/collcections_thumb.png\" width=\"879\" height=\"260\"></a></p> <p>And here is where you go if you have hundreds of them. Psychedelic days are here again!</p> <p><a href=\"http://ayende.com/blog/Images/Windows-Live-Writer/RavenDB-large-number-of_9B5F/image_2.png\"><img style=\"background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/RavenDB-large-number-of_9B5F/image_thumb.png\" width=\"887\" height=\"273\"></a></p>","read":"0"},{"id":"25","feed_id":"2","title":"Habit #7","date":"2013-03-15 05:05:00","body":"<div xmlns=\"http://www.w3.org/1999/xhtml\"><p>The habit of being easily persuaded by mass media</p>\r\n<p>The habit of doing it right instead of doing it over</p>\r\n<p>The habit of responding to nastiness with nastiness</p>\r\n<p>The habit of failing to trust people who care</p>\r\n<p>The habit of wasting time in meetings</p>\r\n<p>The habit of being on time</p>\r\n<p>The habit of avoiding things that cause fear</p>\r\n<p>The habit of reading ahead</p>\r\n<p>The habit of doing more than promised</p>\r\n<p>The habit of expanding personal knowledge and experience</p>\r\n<p>The habit of skepticism</p>\r\n<p>The habit of close talking</p>\r\n<p>The habit of generosity...</p>\r\n<p>There's a million habits out there, some good, some bad, all learned. Every habit (your market, your family, your organization has) was formed because people got rewarded for it, at least in the short run. </p>\r\n<p>The thing is, every habit is changeable with effort.</p></div><div class=\"feedflare\">\n<a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=ADubEXhvNF8:hW47iNn7U_o:yIl2AUoC8zA\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=yIl2AUoC8zA\" border=\"0\"></img></a> <a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=ADubEXhvNF8:hW47iNn7U_o:qj6IDK7rITs\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=qj6IDK7rITs\" border=\"0\"></img></a>\n</div><img src=\"http://feeds.feedburner.com/~r/typepad/sethsmainblog/~4/ADubEXhvNF8\" height=\"1\" width=\"1\"/>","read":"0"},{"id":"8","feed_id":"3","title":"Reviewing RavenBurgerCo: What could be improved?","date":"2013-03-14 10:00:00","body":"<p>There are two things that I would change in the <a href=\"https://github.com/sibartlett/RavenBurgerCo\">RavenBurgerCo</a> sample app.</p> <p>The first would be session management, I dislike code like this:</p> <blockquote> <p><a href=\"http://ayende.com/blog/Images/Windows-Live-Writer/Reviewing-RavenBurgerCo-What-could-be-im_10864/image_2.png\"><img style=\"background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/Reviewing-RavenBurgerCo-What-could-be-im_10864/image_thumb.png\" width=\"471\" height=\"86\"></a></p></blockquote> <p>I would much rather do that in a base controller and avoid manual session management. But that is most a design choice, and it ain’t really that important.</p> <p>But what is important is the number of indexes that the application uses. We have:</p> <ul> <li>LocationIndex</li> <li>DeliveryIndex</li> <li>DriveThruIndex</li></ul> <p>And I am not really sure that we need all three. In fact, I am pretty sure that we don’t. What we can do is merge them all into a single index. I am pretty sure that the reason that there were three of them was because there there was a bug in RavenDB that made it error if you gave it a null WKT (vs. just recognize this an a valid opt out). I fixed that bug, but even with that issue in place, we can get things working:</p> <blockquote> <div id=\"codeSnippetWrapper\"> <div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> <span style=\"color: #0000ff\">public</span> <span style=\"color: #0000ff\">class</span> SpatialIndex : AbstractIndexCreationTask&lt;Restaurant&gt;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span> {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span>     <span style=\"color: #0000ff\">public</span> SpatialIndex()</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum4\">   4:</span>     {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum5\">   5:</span>         Map = restaurants =&gt;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum6\">   6:</span>               from restaurant <span style=\"color: #0000ff\">in</span> restaurants</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum7\">   7:</span>               select <span style=\"color: #0000ff\">new</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum8\">   8:</span>                   {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum9\">   9:</span>                       _ = SpatialGenerate(restaurant.Latitude, restaurant.Longitude),</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum10\">  10:</span>                       __ = restaurant.DriveThruArea == <span style=\"color: #0000ff\">null</span> ? </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum11\">  11:</span>                                     <span style=\"color: #0000ff\">new</span> <span style=\"color: #0000ff\">object</span>[0] : </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum12\">  12:</span>                                     SpatialGenerate(<span style=\"color: #006080\">\"drivethru\"</span>, restaurant.DriveThruArea),</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum13\">  13:</span>                       ___ = restaurant.DeliveryArea == <span style=\"color: #0000ff\">null</span> ? </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum14\">  14:</span>                                     <span style=\"color: #0000ff\">new</span> <span style=\"color: #0000ff\">object</span>[0] : </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum15\">  15:</span>                                     SpatialGenerate(<span style=\"color: #006080\">\"delivery\"</span>, restaurant.DeliveryArea)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum16\">  16:</span>                   };</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum17\">  17:</span>     }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum18\">  18:</span> }</pre><!--CRLF--></div></div></blockquote>\n<p>And from then, it is just a matter of updating the queries, which now looks like the following:</p>\n<p>Getting the restaurants near my location (for Eat In page):</p>\n<blockquote>\n<div id=\"codeSnippetWrapper\">\n<div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> <span style=\"color: #0000ff\">return</span> session.Query&lt;Restaurant, SpatialIndex&gt;()</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span>     .Customize(x =&gt;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span>                    {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum4\">   4:</span>                        x.WithinRadiusOf(25, latitude, longitude);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum5\">   5:</span>                        x.SortByDistance();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum6\">   6:</span>                    })</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum7\">   7:</span>     .Take(250)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum8\">   8:</span>     .Select( ... );</pre><!--CRLF--></div></div></blockquote>\n<p>Getting the restaurants that deliver to my location (Delivery page):</p>\n<blockquote>\n<div id=\"codeSnippetWrapper\">\n<div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> <span style=\"color: #0000ff\">return</span> session.Query&lt;Restaurant, SpatialIndex&gt;()</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span>     .Customize(x =&gt; x.RelatesToShape(<span style=\"color: #006080\">\"delivery\"</span>, point, SpatialRelation.Intersects))</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span>     <span style=\"color: #008000\">// SpatialRelation.Contains is not supported</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum4\">   4:</span>     <span style=\"color: #008000\">// SpatialRelation.Intersects is OK because we are using a point as the query parameter</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum5\">   5:</span>     .Take(250)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum6\">   6:</span>     .Select( ... ) ;</pre><!--CRLF--></div></div></blockquote>\n<p>Getting the restaurants inside a particular rectangle (Map page):</p>\n<blockquote>\n<div id=\"codeSnippetWrapper\">\n<div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> <span style=\"color: #0000ff\">return</span> session.Query&lt;Restaurant, SpatialIndex&gt;()</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span>     .Customize(x =&gt; x.RelatesToShape(Constants.DefaultSpatialFieldName, rectangle, SpatialRelation.Within))</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span>     .Take(512)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum4\">   4:</span>     .Select( ... );</pre><!--CRLF--></div></div></blockquote>\n<p>Note that we use DefaultSpatialFieldName, instead of indexing the location twice.</p>\n<p>And finally, getting the restaurants that are applicable for drive through for my route (Drive Thru page):</p>\n<blockquote>\n<div id=\"codeSnippetWrapper\">\n<div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> <span style=\"color: #0000ff\">return</span> session.Query&lt;Restaurant, SpatialIndex&gt;()</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span>     .Customize(x =&gt; x.RelatesToShape(<span style=\"color: #006080\">\"drivethru\"</span>, lineString, SpatialRelation.Intersects))</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span>     .Take(512)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum4\">   4:</span>     .Select( ... );</pre><!--CRLF--></div></div></blockquote>\n<p>And that is that. </p>\n<p>Really great project, and quite amazing, both client &amp; server code. It is simple, it is elegant and it is effective. Well done Simon!</p>","read":"0"},{"id":"26","feed_id":"2","title":"\"You've got ping, but they've got no pong\"","date":"2013-03-14 05:33:00","body":"<div xmlns=\"http://www.w3.org/1999/xhtml\"><p>It's almost impossible to have fun playing ping pong with someone who doesn't care, won't try or isn't any good.</p>\r\n<p>The same thing is true of just about anything that matters in the connection economy. A consultation with a surgeon, creating a new conference or working in partnership with an ad agency... If you're going to create something worth building, it's going to be because there's an infinite game going on, not merely blind obedience and tired conformity. </p>\r\n<p>You can take a great deal of responsibility for creating this mutual enthusiasm, and you can put the effort into creating an environment and a story where it's likely to happen.</p>\r\n<p>Connection requires energy and insight and enthusiasm from both sides, and if your partner isn't responding, look hard at why. Of course, if you can't bring your half, stay home.</p></div><div class=\"feedflare\">\n<a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=kA915B1JidE:ttRxo4lcfaE:yIl2AUoC8zA\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=yIl2AUoC8zA\" border=\"0\"></img></a> <a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=kA915B1JidE:ttRxo4lcfaE:qj6IDK7rITs\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=qj6IDK7rITs\" border=\"0\"></img></a>\n</div><img src=\"http://feeds.feedburner.com/~r/typepad/sethsmainblog/~4/kA915B1JidE\" height=\"1\" width=\"1\"/>","read":"0"},{"id":"9","feed_id":"3","title":"Reviewing RavenBurgerCo","date":"2013-03-13 10:00:00","body":"<p>This is a review of <a href=\"https://github.com/sibartlett/RavenBurgerCo\">RavenBurgerCo</a>, created as a sample app for RavenDB spatial support by Simon Bartlett. This is by no means an unbiased review, if only because I had laughed out load and crazily when I saw the first page:</p> <p><a href=\"http://ayende.com/blog/Images/Windows-Live-Writer/00a37bfea13d_FD25/image_2.png\"><img style=\"background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/00a37bfea13d_FD25/image_thumb.png\" width=\"646\" height=\"777\"></a></p> <p>What is this about?</p> <blockquote> <p>Raven Burger Co is a chain of fast food restaurants, based in the United Kingdom. Their speciality is burgers made with raven meat. All their restaurants offer eat-in/take-out service, while some offer home delivery, and others offer a drive thru service. <p>This sample application is their online restaurant locator.</p></blockquote> <p>Good things about this project? Here is how you get started: <ol> <li>Clone this repository  <li>Open the solution in Visual Studio 2012  <li>Press F5  <li>Play!</li></ol> <p>And it actually works! It uses embeddable RavenDB to make it super easy and stupid to run it, right out of the box. </p> <p>We will start this review by looking at the infrastructure for this project, starting, as usual, from Global.asax:</p> <p><a href=\"http://ayende.com/blog/Images/Windows-Live-Writer/00a37bfea13d_FD25/image_6.png\"><img style=\"background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/00a37bfea13d_FD25/image_thumb_2.png\" width=\"480\" height=\"189\"></a></p> <p>Let us see how RavenDB is setup:</p> <blockquote> <div id=\"codeSnippetWrapper\"> <div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> <span style=\"color: #0000ff\">public</span> <span style=\"color: #0000ff\">static</span> <span style=\"color: #0000ff\">void</span> ConfigureRaven(MvcApplication application)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span> {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span>     var store = <span style=\"color: #0000ff\">new</span> EmbeddableDocumentStore</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum4\">   4:</span>                         {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum5\">   5:</span>                             DataDirectory = <span style=\"color: #006080\">\"~/App_Data/Database\"</span>,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum6\">   6:</span>                             UseEmbeddedHttpServer = <span style=\"color: #0000ff\">true</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum7\">   7:</span>                         };</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum8\">   8:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum9\">   9:</span>     store.Initialize();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum10\">  10:</span>     MvcApplication.DocumentStore = store;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum11\">  11:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum12\">  12:</span>     IndexCreation.CreateIndexes(<span style=\"color: #0000ff\">typeof</span>(MvcApplication).Assembly, store);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum13\">  13:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum14\">  14:</span>     var statistics = store.DatabaseCommands.GetStatistics();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum15\">  15:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum16\">  16:</span>     <span style=\"color: #0000ff\">if</span> (statistics.CountOfDocuments &lt; 5)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum17\">  17:</span>         <span style=\"color: #0000ff\">using</span> (var bulkInsert = store.BulkInsert())</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum18\">  18:</span>             LoadRestaurants(application.Server.MapPath(<span style=\"color: #006080\">\"~/App_Data/Restaurants.csv\"</span>), bulkInsert);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum19\">  19:</span> }</pre><!--CRLF--></div></div></blockquote>\n<p>So use embedded RavenDB, and if there isn’t enough data in the db, load the default data set using RavenDB’s new Bulk Insert feature.</p>\n<p>Note that we set MvcApplication.DocumentStore property, let us see how this is used. </p>\n<p>Simon did a really nice thing here. Note that UseEmbeddedHttpServer is set to true, which means that RavenDB will find an open port and use it, this is then exposed in the UI:</p>\n<p><a href=\"http://ayende.com/blog/Images/Windows-Live-Writer/00a37bfea13d_FD25/image_8.png\"><img style=\"background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/00a37bfea13d_FD25/image_thumb_3.png\" width=\"180\" height=\"140\"></a></p>\n<p>So you can click on the link and land right in the studio for your embedded database, which gives you the ability to view, debug &amp; modify how things are actually going. This is a really nice way to expose it.</p>\n<p>Now, let us move to the actual project code itself. Exploring the options in this project, we have map browsing:</p>\n<p><a href=\"http://ayende.com/blog/Images/Windows-Live-Writer/00a37bfea13d_FD25/image_4.png\"><img style=\"background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/00a37bfea13d_FD25/image_thumb_1.png\" width=\"784\" height=\"377\"></a></p>\n<p>And here I have to admit ignorance. I have no idea on how to use maps, so this is quite nice for me, something new to learn. The core of this page is this script:</p>\n<blockquote>\n<div id=\"codeSnippetWrapper\">\n<div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> $(<span style=\"color: #0000ff\">function</span> () {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span>     <span style=\"color: #0000ff\">var</span> gmapLayer = <span style=\"color: #0000ff\">new</span> L.Google(<span style=\"color: #006080\">'ROADMAP'</span>);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum4\">   4:</span>     <span style=\"color: #0000ff\">var</span> resultsLayer = L.layerGroup();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum5\">   5:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum6\">   6:</span>     <span style=\"color: #0000ff\">var</span> map = L.map(<span style=\"color: #006080\">'map'</span>, {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum7\">   7:</span>         layers: [gmapLayer, resultsLayer],</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum8\">   8:</span>         center: [51.4775, -0.461389],</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum9\">   9:</span>         zoom: 12,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum10\">  10:</span>         maxBounds: L.latLngBounds([49, 15], [60, -25])</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum11\">  11:</span>     });</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum12\">  12:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum13\">  13:</span>     <span style=\"color: #0000ff\">var</span> loadMarkers = <span style=\"color: #0000ff\">function</span>() {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum14\">  14:</span>         <span style=\"color: #0000ff\">if</span> (map.getZoom() &gt; 9) {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum15\">  15:</span>             <span style=\"color: #0000ff\">var</span> bounds = map.getBounds();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum16\">  16:</span>             $.get(<span style=\"color: #006080\">'/api/restaurants'</span>, {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum17\">  17:</span>                 north: bounds.getNorthWest().lat,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum18\">  18:</span>                 east: bounds.getSouthEast().lng,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum19\">  19:</span>                 south: bounds.getSouthEast().lat,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum20\">  20:</span>                 west: bounds.getNorthWest().lng,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum21\">  21:</span>             }).done(<span style=\"color: #0000ff\">function</span>(restaurants) {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum22\">  22:</span>                 resultsLayer.clearLayers();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum23\">  23:</span>                 $.each(restaurants, <span style=\"color: #0000ff\">function</span>(index, value) {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum24\">  24:</span>                     <span style=\"color: #0000ff\">var</span> marker = L.marker([value.Latitude, value.Longitude])</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum25\">  25:</span>                         .bindPopup(</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum26\">  26:</span>                             <span style=\"color: #006080\">'&lt;p&gt;&lt;strong&gt;'</span> + value.Name + <span style=\"color: #006080\">'&lt;/strong&gt;&lt;br /&gt;'</span> +</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum27\">  27:</span>                                 value.Street + <span style=\"color: #006080\">'&lt;br /&gt;'</span> +</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum28\">  28:</span>                                 value.City + <span style=\"color: #006080\">'&lt;br /&gt;'</span> +</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum29\">  29:</span>                                 value.PostCode + <span style=\"color: #006080\">'&lt;br /&gt;'</span> +</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum30\">  30:</span>                                 value.Phone + <span style=\"color: #006080\">'&lt;/p&gt;'</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum31\">  31:</span>                         );</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum32\">  32:</span>                     resultsLayer.addLayer(marker);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum33\">  33:</span>                 });</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum34\">  34:</span>             });</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum35\">  35:</span>         } <span style=\"color: #0000ff\">else</span> {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum36\">  36:</span>             resultsLayer.clearLayers();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum37\">  37:</span>         }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum38\">  38:</span>     };</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum39\">  39:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum40\">  40:</span>     loadMarkers();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum41\">  41:</span>     map.on(<span style=\"color: #006080\">'moveend'</span>, loadMarkers);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum42\">  42:</span> });</pre><!--CRLF--></div></div></blockquote>\n<p>You can see that loadMarkers method, which is getting called whenever the map is moved, and on startup. This end up calling this method with the boundaries of the visible UI on the server:</p>\n<blockquote>\n<div id=\"codeSnippetWrapper\">\n<div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> <span style=\"color: #0000ff\">public</span> IEnumerable&lt;<span style=\"color: #0000ff\">object</span>&gt; Get(<span style=\"color: #0000ff\">double</span> north, <span style=\"color: #0000ff\">double</span> east, <span style=\"color: #0000ff\">double</span> west, <span style=\"color: #0000ff\">double</span> south)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span> {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span>     <span style=\"color: #0000ff\">var</span> rectangle = <span style=\"color: #0000ff\">string</span>.Format(CultureInfo.InvariantCulture, <span style=\"color: #006080\">\"{0:F6} {1:F6} {2:F6} {3:F6}\"</span>, west, south, east, north);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum4\">   4:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum5\">   5:</span>     <span style=\"color: #0000ff\">using</span> (<span style=\"color: #0000ff\">var</span> session = MvcApplication.DocumentStore.OpenSession())</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum6\">   6:</span>     {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum7\">   7:</span>         <span style=\"color: #0000ff\">return</span> session.Query&lt;Restaurant, LocationIndex&gt;()</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum8\">   8:</span>             .Customize(x =&gt; x.RelatesToShape(<span style=\"color: #006080\">\"location\"</span>, rectangle, SpatialRelation.Within))</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum9\">   9:</span>             .Take(512)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum10\">  10:</span>             .Select(x =&gt; <span style=\"color: #0000ff\">new</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum11\">  11:</span>                             {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum12\">  12:</span>                                 x.Name,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum13\">  13:</span>                                 x.Street,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum14\">  14:</span>                                 x.City,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum15\">  15:</span>                                 x.PostCode,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum16\">  16:</span>                                 x.Phone,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum17\">  17:</span>                                 x.Delivery,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum18\">  18:</span>                                 x.DriveThru,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum19\">  19:</span>                                 x.Latitude,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum20\">  20:</span>                                 x.Longitude</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum21\">  21:</span>                             })</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum22\">  22:</span>             .ToList();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum23\">  23:</span>     }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum24\">  24:</span> }</pre><!--CRLF--></div></div></blockquote>\n<p>Note that in this case, we are doing a search for items inside the rectangle. But the search options are a bit funky. You have to send the data in <a href=\"http://en.wikipedia.org/wiki/Well-known_text\">WKT format</a>.&nbsp; Luckily, Simon already create a better solution (in this case, he is using the long hand method to make sure that we all understand what he is doing). The better method would be to use <a href=\"https://github.com/sibartlett/Geo\">his Geo library</a>, in which case the code would look like:</p>\n<blockquote>\n<div id=\"codeSnippetWrapper\">\n<div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> .Geo(<span style=\"color: #006080\">\"location\"</span>, x =&gt; x.RelatesToShape(<span style=\"color: #0000ff\">new</span> Rectangle(west, south, east, north), SpatialRelation.Within))</pre><!--CRLF--></div></div></blockquote>\n<p>So that was the map, now let us look at another example, the Eat In example. In that case, we are looking for restaurants near our location to be figure out where to eat. This looks like this:</p>\n<blockquote>\n<p><a href=\"http://ayende.com/blog/Images/Windows-Live-Writer/00a37bfea13d_FD25/image_10.png\"><img style=\"background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/00a37bfea13d_FD25/image_thumb_4.png\" width=\"411\" height=\"367\"></a></p></blockquote>\n<p>Right in the bull’s eye! </p>\n<p>Here is the server side code:</p>\n<blockquote>\n<div id=\"codeSnippetWrapper\">\n<div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> <span style=\"color: #0000ff\">public</span> IEnumerable&lt;<span style=\"color: #0000ff\">object</span>&gt; Get(<span style=\"color: #0000ff\">double</span> latitude, <span style=\"color: #0000ff\">double</span> longitude)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span> {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span>     <span style=\"color: #0000ff\">using</span> (<span style=\"color: #0000ff\">var</span> session = MvcApplication.DocumentStore.OpenSession())</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum4\">   4:</span>     {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum5\">   5:</span>         <span style=\"color: #0000ff\">return</span> session.Query&lt;Restaurant, LocationIndex&gt;()</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum6\">   6:</span>             .Customize(x =&gt;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum7\">   7:</span>                            {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum8\">   8:</span>                                x.WithinRadiusOf(25, latitude, longitude);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum9\">   9:</span>                                x.SortByDistance();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum10\">  10:</span>                            })</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum11\">  11:</span>             .Take(250)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum12\">  12:</span>             .Select(x =&gt; <span style=\"color: #0000ff\">new</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum13\">  13:</span>                             {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum14\">  14:</span>                                 x.Name,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum15\">  15:</span>                                 x.Street,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum16\">  16:</span>                                 x.City,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum17\">  17:</span>                                 x.PostCode,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum18\">  18:</span>                                 x.Phone,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum19\">  19:</span>                                 x.Delivery,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum20\">  20:</span>                                 x.DriveThru,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum21\">  21:</span>                                 x.Latitude,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum22\">  22:</span>                                 x.Longitude</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum23\">  23:</span>                             })</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum24\">  24:</span>             .ToList();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum25\">  25:</span>     }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum26\">  26:</span> }</pre><!--CRLF--></div></div></blockquote>\n<p>And on the client side, we just do the following:</p>\n<blockquote>\n<div id=\"codeSnippetWrapper\">\n<div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> $(<span style=\"color: #006080\">'#location'</span>).change(<span style=\"color: #0000ff\">function</span> () {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span>     <span style=\"color: #0000ff\">var</span> latlng = $(<span style=\"color: #006080\">'#location'</span>).locationSelector(<span style=\"color: #006080\">'val'</span>);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum4\">   4:</span>     <span style=\"color: #0000ff\">var</span> outerCircle = L.circle(latlng, 25000, { color: <span style=\"color: #006080\">'#ff0000'</span>, fillOpacity: 0 });</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum5\">   5:</span>     map.fitBounds(outerCircle.getBounds());</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum6\">   6:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum7\">   7:</span>     resultsLayer.clearLayers();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum8\">   8:</span>     resultsLayer.addLayer(outerCircle);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum9\">   9:</span>     resultsLayer.addLayer(L.circle(latlng, 15000, { color: <span style=\"color: #006080\">'#ff0000'</span>, fillOpacity: 0.1 }));</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum10\">  10:</span>     resultsLayer.addLayer(L.circle(latlng, 10000, { color: <span style=\"color: #006080\">'#ff0000'</span>, fillOpacity: 0.3 }));</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum11\">  11:</span>     resultsLayer.addLayer(L.circle(latlng, 5000, { color: <span style=\"color: #006080\">'#ff0000'</span>, fillOpacity: 0.5 }));</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum12\">  12:</span>     resultsLayer.addLayer(L.circleMarker(latlng, { color: <span style=\"color: #006080\">'#ff0000'</span>, fillOpacity: 1, opacity: 1 }));</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum13\">  13:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum14\">  14:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum15\">  15:</span>     $.get(<span style=\"color: #006080\">'/api/restaurants'</span>, {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum16\">  16:</span>         latitude: latlng[0],</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum17\">  17:</span>         longitude: latlng[1]</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum18\">  18:</span>     }).done(<span style=\"color: #0000ff\">function</span> (restaurants) {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum19\">  19:</span>         $.each(restaurants, <span style=\"color: #0000ff\">function</span> (index, value) {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum20\">  20:</span>             <span style=\"color: #0000ff\">var</span> marker = L.marker([value.Latitude, value.Longitude])</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum21\">  21:</span>                 .bindPopup(</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum22\">  22:</span>                     <span style=\"color: #006080\">'&lt;p&gt;&lt;strong&gt;'</span> + value.Name + <span style=\"color: #006080\">'&lt;/strong&gt;&lt;br /&gt;'</span> +</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum23\">  23:</span>                     value.Street + <span style=\"color: #006080\">'&lt;br /&gt;'</span> +</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum24\">  24:</span>                     value.City + <span style=\"color: #006080\">'&lt;br /&gt;'</span> +</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum25\">  25:</span>                     value.PostCode + <span style=\"color: #006080\">'&lt;br /&gt;'</span> +</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum26\">  26:</span>                     value.Phone + <span style=\"color: #006080\">'&lt;/p&gt;'</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum27\">  27:</span>                 );</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum28\">  28:</span>             resultsLayer.addLayer(marker);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum29\">  29:</span>         });</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum30\">  30:</span>     });</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum31\">  31:</span> });</pre><!--CRLF--></div></div></blockquote>\n<p>We define several circles of different opacities, and then show up the returned markers.</p>\n<p>It is all pretty simple code, but the result it quite stunning. I am getting really excited by this thing. It is simple, beautiful and quite powerful. Wow! </p>\n<p>The delivery tab does pretty much the same thing as the eat-in mode, but it does so in a different way. First, you might have noticed the LocationIndex in the previous two examples, this looks like this:</p>\n<blockquote>\n<div id=\"codeSnippetWrapper\">\n<div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> <span style=\"color: #0000ff\">public</span> <span style=\"color: #0000ff\">class</span> LocationIndex : AbstractIndexCreationTask&lt;Restaurant&gt;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span> {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span>     <span style=\"color: #0000ff\">public</span> LocationIndex()</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum4\">   4:</span>     {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum5\">   5:</span>         Map = restaurants =&gt; from restaurant <span style=\"color: #0000ff\">in</span> restaurants</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum6\">   6:</span>                              select <span style=\"color: #0000ff\">new</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum7\">   7:</span>                                         {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum8\">   8:</span>                                             restaurant.Name,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum9\">   9:</span>                                             _ = SpatialGenerate(restaurant.Latitude, restaurant.Longitude),</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum10\">  10:</span>                                             __ = SpatialGenerate(<span style=\"color: #006080\">\"location\"</span>, restaurant.LocationWkt)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum11\">  11:</span>                                         };</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum12\">  12:</span>     }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum13\">  13:</span> }</pre><!--CRLF--></div></div></blockquote>\n<p>Before we look at this, we need to look at a sample document:</p>\n<p><a href=\"http://ayende.com/blog/Images/Windows-Live-Writer/00a37bfea13d_FD25/image_12.png\"><img style=\"background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/00a37bfea13d_FD25/image_thumb_5.png\" width=\"550\" height=\"426\"></a></p>\n<p>I am note quite sure why we have in LocationIndex both SpatialGenerate() and SpatialGenerate(“location”). I think that this is just a part of the demo. Because the data is the same, and both lines should produce the same results.</p>\n<p>However, for deliveries, the situation is <em>quite</em> different. We don’t just deliver to a certain distance, as you can see, we have a polygon that determines where do we actually delivers to. On the map, this looks like this:</p>\n<blockquote>\n<p><a href=\"http://ayende.com/blog/Images/Windows-Live-Writer/00a37bfea13d_FD25/image_14.png\"><img style=\"background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/00a37bfea13d_FD25/image_thumb_6.png\" width=\"517\" height=\"431\"></a></p></blockquote>\n<p>The red circle is where I am located, the blue markers are the restaurants that delivers to my location and the blue polygon is the delivery area for the selected burger joint. Let us see how this works, okay? We will start from the index:</p>\n<blockquote>\n<div id=\"codeSnippetWrapper\">\n<div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> <span style=\"color: #0000ff\">public</span> <span style=\"color: #0000ff\">class</span> DeliveryIndex : AbstractIndexCreationTask&lt;Restaurant&gt;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span> {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span>     <span style=\"color: #0000ff\">public</span> DeliveryIndex()</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum4\">   4:</span>     {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum5\">   5:</span>         Map = restaurants =&gt; from restaurant <span style=\"color: #0000ff\">in</span> restaurants</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum6\">   6:</span>                              where restaurant.DeliveryArea != <span style=\"color: #0000ff\">null</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum7\">   7:</span>                              select <span style=\"color: #0000ff\">new</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum8\">   8:</span>                                         {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum9\">   9:</span>                                             restaurant.Name,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum10\">  10:</span>                                             _ = SpatialGenerate(<span style=\"color: #006080\">\"delivery\"</span>, restaurant.DeliveryArea, SpatialSearchStrategy.GeohashPrefixTree, 7)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum11\">  11:</span>                                         };</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum12\">  12:</span>     }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum13\">  13:</span> }</pre><!--CRLF--></div></div></blockquote>\n<p>So we are indexing just restaurants that have a drive through polygon, and then we query it like this:</p>\n<blockquote>\n<div id=\"codeSnippetWrapper\">\n<div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> <span style=\"color: #0000ff\">public</span> IEnumerable&lt;<span style=\"color: #0000ff\">object</span>&gt; Get(<span style=\"color: #0000ff\">double</span> latitude, <span style=\"color: #0000ff\">double</span> longitude, <span style=\"color: #0000ff\">bool</span> delivery)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span> {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span>     <span style=\"color: #0000ff\">if</span> (!delivery)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum4\">   4:</span>         <span style=\"color: #0000ff\">return</span> Get(latitude, longitude);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum5\">   5:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum6\">   6:</span>     <span style=\"color: #0000ff\">var</span> point = <span style=\"color: #0000ff\">string</span>.Format(CultureInfo.InvariantCulture, <span style=\"color: #006080\">\"POINT ({0} {1})\"</span>, longitude, latitude);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum7\">   7:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum8\">   8:</span>     <span style=\"color: #0000ff\">using</span> (<span style=\"color: #0000ff\">var</span> session = MvcApplication.DocumentStore.OpenSession())</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum9\">   9:</span>     {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum10\">  10:</span>         <span style=\"color: #0000ff\">return</span> session.Query&lt;Restaurant, DeliveryIndex&gt;()</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum11\">  11:</span>             .Customize(x =&gt; x.RelatesToShape(<span style=\"color: #006080\">\"delivery\"</span>, point, SpatialRelation.Intersects))</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum12\">  12:</span>             <span style=\"color: #008000\">// SpatialRelation.Contains is not supported</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum13\">  13:</span>             <span style=\"color: #008000\">// SpatialRelation.Intersects is OK because we are using a point as the query parameter</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum14\">  14:</span>             .Take(250)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum15\">  15:</span>             .Select(x =&gt; <span style=\"color: #0000ff\">new</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum16\">  16:</span>                             {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum17\">  17:</span>                                 x.Name,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum18\">  18:</span>                                 x.Street,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum19\">  19:</span>                                 x.City,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum20\">  20:</span>                                 x.PostCode,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum21\">  21:</span>                                 x.Phone,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum22\">  22:</span>                                 x.Delivery,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum23\">  23:</span>                                 x.DriveThru,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum24\">  24:</span>                                 x.Latitude,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum25\">  25:</span>                                 x.Longitude,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum26\">  26:</span>                                 x.DeliveryArea</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum27\">  27:</span>                             })</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum28\">  28:</span>             .ToList();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum29\">  29:</span>     }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum30\">  30:</span> }</pre><!--CRLF--></div></div></blockquote>\n<p>This basically says, give me all the Restaurants who delivers to a locations that includes me. And then the rest all happens on the client side.</p>\n<p><em>Quite</em> cool.</p>\n<p>The final example is the drive thru mode, which looks like this:</p>\n<blockquote>\n<p><a href=\"http://ayende.com/blog/Images/Windows-Live-Writer/00a37bfea13d_FD25/image_16.png\"><img style=\"background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/00a37bfea13d_FD25/image_thumb_7.png\" width=\"442\" height=\"551\"></a></p></blockquote>\n<p>Given that I am driving from the green dot to the red dot, what restaurants can I stop at?</p>\n<p>Here is the index:</p>\n<blockquote>\n\n<div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> <span style=\"color: #0000ff\">public</span> <span style=\"color: #0000ff\">class</span> DriveThruIndex : AbstractIndexCreationTask&lt;Restaurant&gt;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span> {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span>     <span style=\"color: #0000ff\">public</span> DriveThruIndex()</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum4\">   4:</span>     {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum5\">   5:</span>         Map = restaurants =&gt; from restaurant <span style=\"color: #0000ff\">in</span> restaurants</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum6\">   6:</span>                              where restaurant.DriveThruArea != <span style=\"color: #0000ff\">null</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum7\">   7:</span>                              select <span style=\"color: #0000ff\">new</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum8\">   8:</span>                                         {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum9\">   9:</span>                                             restaurant.Name,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum10\">  10:</span>                                             _ = SpatialGenerate(<span style=\"color: #006080\">\"drivethru\"</span>, restaurant.DriveThruArea)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum11\">  11:</span>                                         };</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum12\">  12:</span>     }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum13\">  13:</span> }</pre><!--CRLF--></div></blockquote>\n<p>And now the code for this:</p>\n<blockquote>\n<div id=\"codeSnippetWrapper\">\n<div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> <span style=\"color: #0000ff\">public</span> IEnumerable&lt;<span style=\"color: #0000ff\">object</span>&gt; Get(<span style=\"color: #0000ff\">string</span> polyline)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span> {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span>     <span style=\"color: #0000ff\">var</span> lineString = PolylineHelper.ConvertGooglePolylineToWkt(polyline);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum4\">   4:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum5\">   5:</span>     <span style=\"color: #0000ff\">using</span> (<span style=\"color: #0000ff\">var</span> session = MvcApplication.DocumentStore.OpenSession())</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum6\">   6:</span>     {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum7\">   7:</span>         <span style=\"color: #0000ff\">return</span> session.Query&lt;Restaurant, DriveThruIndex&gt;()</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum8\">   8:</span>             .Customize(x =&gt; x.RelatesToShape(<span style=\"color: #006080\">\"drivethru\"</span>, lineString, SpatialRelation.Intersects))</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum9\">   9:</span>             .Take(512)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum10\">  10:</span>             .Select(x =&gt; <span style=\"color: #0000ff\">new</span></pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum11\">  11:</span>                             {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum12\">  12:</span>                                 x.Name,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum13\">  13:</span>                                 x.Street,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum14\">  14:</span>                                 x.City,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum15\">  15:</span>                                 x.PostCode,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum16\">  16:</span>                                 x.Phone,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum17\">  17:</span>                                 x.Delivery,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum18\">  18:</span>                                 x.DriveThru,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum19\">  19:</span>                                 x.Latitude,</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum20\">  20:</span>                                 x.Longitude</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum21\">  21:</span>                             })</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum22\">  22:</span>             .ToList();</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum23\">  23:</span>     }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum24\">  24:</span> }</pre><!--CRLF--></div></div></blockquote>\n<p>We get the driving direction from the map, convert it to a line string, and then just check if our path intersects with the drive thru area for the restaurants.</p>\n<p>Pretty cool application, and some <em>really</em> nice UI.</p>\n<p>Okay, enough with the accolades, next time, I’ll talk about the things that can be better.</p>","read":"0"},{"id":"27","feed_id":"2","title":"Choose your customers first","date":"2013-03-13 05:19:00","body":"<div xmlns=\"http://www.w3.org/1999/xhtml\"><p>It seems obvious, doesn't it? Each cohort of customers has a particular worldview, a set of problems, a small possible set of solutions available. Each cohort has a price they're willing to pay, a story they're willing to hear, a period of time they're willing to invest.</p>\r\n<p>And yet...</p>\r\n<p>And yet too often, we pick the product or service first, deciding that it's perfect and then rushing to market, sure that the audience will sort itself out. Too often, though, we end up with nothing.</p>\r\n<p>Examples:</p>\r\n<p>The real estate broker ought to pick which sort of buyer before she goes out to buy business cards, rent an office or get listings. </p>\r\n<p>The bowling alley investor ought to pick whether he's hoping for serious league players or girls-night-out partiers before he buys a building or uniforms.</p>\r\n<p>The yoga instructor, the corporate coach, the app developer--in every case, first figure out who you'd like to do business with, <em>then</em> go make something just for them. The more specific the better...</p></div><div class=\"feedflare\">\n<a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=1697bMVLDkw:MED0LaNhx0k:yIl2AUoC8zA\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=yIl2AUoC8zA\" border=\"0\"></img></a> <a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=1697bMVLDkw:MED0LaNhx0k:qj6IDK7rITs\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=qj6IDK7rITs\" border=\"0\"></img></a>\n</div><img src=\"http://feeds.feedburner.com/~r/typepad/sethsmainblog/~4/1697bMVLDkw\" height=\"1\" width=\"1\"/>","read":"0"},{"id":"28","feed_id":"2","title":"The moment of highest leverage","date":"2013-03-12 10:40:29","body":"<p>It doesn’t happen often, but when it does, don’t waste it.<br><br>You’ve already won (or you’ve already lost). Right now, you can choose to do what’s in your heart, you can bring your real work to the world, instead of a lesser version, a version you think the market wants. After all, what do you have to lose?<br><br>When it feels like it’s hopeless or when it appears to be a lock, why not?<br><br>So you bring your true self to the work, your unadulterated effort, without negative self-talk and the sanding off of the interesting edges. Instead of compromise, you bring us vision.<br><br>Of course, when we see that reality, the kamiwaza of what you’re able to do when you’re not second guessing or giving up, the odds of transformation go way up. In fact, you haven't already lost, because your magical, vulnerable work changes everything.<br><br>You won’t get this chance again soon (unless you choose to). So go.</p><div class=\"feedflare\">\n<a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=16jjej6OCYA:fRC3SYv7W9s:yIl2AUoC8zA\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=yIl2AUoC8zA\" border=\"0\"></img></a> <a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=16jjej6OCYA:fRC3SYv7W9s:qj6IDK7rITs\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=qj6IDK7rITs\" border=\"0\"></img></a>\n</div><img src=\"http://feeds.feedburner.com/~r/typepad/sethsmainblog/~4/16jjej6OCYA\" height=\"1\" width=\"1\"/>","read":"0"},{"id":"10","feed_id":"3","title":"RavenDB’s Querying Streaming: Unbounded results","date":"2013-03-12 10:00:00","body":"<p>By default, RavenDB make it pretty hard to shoot yourself in the foot with unbounded result sets. Pretty much every single feature has rate limits on it, and that is a good thing.</p> <p>However, there are times where you actually do want to get <em>all</em> where all actually means <em>everything damn you, really all of them</em>. That has been somewhat tough to do, because it requires you to do paging, and if you are trying to do that on a running system, it is possible that incoming data will impact the way you are exporting, causing you to get duplicates or miss items.</p> <p>We got several suggestions about how to handle that, but most of those were pretty complex. Instead, we decided to go with the following approach:</p> <ul> <li>We will utilize our existing infrastructure to handle exports.</li> <li>We don’t want to do that in multiple requests, because that means that state has to be kept on both client &amp; server.</li> <li>The model has to be a streaming based model, because otherwise we might get memory errors if you are trying to load millions of records out.</li> <li>The stream you get out is <em>frozen</em>, that means that what you read (both indexes and data) is a snapshot of the data <em>as it was when you started reading it</em>.</li></ul> <p>And now, let me show you the API for that:</p> <blockquote> <div id=\"codeSnippetWrapper\"> <div style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum1\">   1:</span> <span style=\"color: #0000ff\">using</span> (var session = store.OpenSession())</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum2\">   2:</span> {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum3\">   3:</span>     var query = session.Query&lt;User&gt;(<span style=\"color: #006080\">\"Users/ByActive\"</span>)</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum4\">   4:</span>                        .Where(x =&gt; x.Active);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum5\">   5:</span>     var enumerator = session.Advanced.Stream(query);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum6\">   6:</span>     <span style=\"color: #0000ff\">int</span> count = 0;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum7\">   7:</span>     <span style=\"color: #0000ff\">while</span> (enumerator.MoveNext())</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum8\">   8:</span>     {</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum9\">   9:</span>         Assert.IsType&lt;User&gt;(enumerator.Current.Document);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum10\">  10:</span>         count++;</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum11\">  11:</span>     }</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum12\">  12:</span>&nbsp; </pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum13\">  13:</span>     Assert.Equal(1500, count);</pre><!--CRLF--><pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\"><span style=\"color: #606060\" id=\"lnum14\">  14:</span> }</pre><!--CRLF--></div></div></blockquote>\n<p>As you can see, we use standard Linq to limit our search, and the new method we have is Stream(), which allows us to get an IEnumerator, which will scan through the data.</p>\n<p>You can see that we are able to get more than the default 1,024 limit of items from RavenDB. There are overloads there for getting additional information about the query as well (total results, timestamps, etags, etc).</p>\n<p>Note that the values returning from the Stream() are <em>not</em> tracked by the session. And that if we had a users #1231 that was deleted 2 ms after the export began, <em>you would still get it, since the data is frozen at the time of the export start</em>.</p>\n<p>If you want, mind, you <em>can</em> specify paging, by the way, and all the other indexing options are also available for you as well (transform results, for example).</p>","read":"0"},{"id":"11","feed_id":"3","title":"RavenDB Spatial Webinar is up","date":"2013-03-11 15:18:00","body":"<div style=\"padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px\" id=\"scid:5737277B-5D6D-4f48-ABFC-DD9C333F4C5D:b28b2f74-0ded-4d9b-aa88-9b06a14010bc\" class=\"wlWriterEditableSmartContent\"><div><object width=\"448\" height=\"252\"><param name=\"movie\" value=\"http://www.youtube.com/v/z8TC-4AULTo?hl=en&amp;hd=1\"></param><embed src=\"http://www.youtube.com/v/z8TC-4AULTo?hl=en&amp;hd=1\" type=\"application/x-shockwave-flash\" width=\"448\" height=\"252\"></embed></object></div></div>","read":"0"},{"id":"12","feed_id":"3","title":"RavenDB Feature Request Analysis: Filtered Replication ain’t what you looking for","date":"2013-03-11 10:00:00","body":"<p>Every so often we get a request for filtered replication. “I want to replicate to this node, but only those documents.” We explain that replication is a whole database kind of thing, you can’t just pick &amp; choose what you want. That isn’t actually true, we have facilities to do filtering, and it would be fairly easy to expose them.</p> <p>We don’t intend to do so. And the reason why is that the customer asking the question is usually starting asking us question from midway. He read about replication, thought that it would be a good fit for a particular scenario, if only it had that feature. Except that this is completely the wrong feature to use for the scenario at hand. And usually it takes a little back &amp; forth to figure out what the scenario actually <em>is</em>.</p> <p>For the most part, the scenarios for this feature are all about <em>synchronizing</em> data between two nodes*. In particular, that is often a use case for: “I have a mobile client and I want to replicate some of the data to that laptop”, or some such.</p> <p>And this is where things gets complex. To start with, you say, let us just filtered the data where CustomerId = “customers/5”. Except that you need to apply this logic for each entity type in the database, and they usually have different rules about them. For example, you may have common reference data that you would want to replication, even though they don’t belong to customers/5. And invoices may have CustomerId property, but customers does not, so you need to define that for customers, it is the Id that you want to filter by, etc.</p> <p>To make things even more interesting, you need to consider the case where the sync filter have <em>changed</em>, (this user now have access to “customers/5” and “customers/6”). At which point, you pretty much have to go and go through the entire data set again.</p> <p>Then we move to the question of updates, how are those handled? What about conflicts? How do you handle disconnected clients that may move between addresses and ips all the time? Who maintains this operation? The client? The server? How about disconnected updates?</p> <p>In short, it is a very different discussion that you need to have, and just exposing the replication filters won’t be that.</p> <p>* Nitpicker corner: yes, I know about MS Sync. </p>","read":"0"},{"id":"29","feed_id":"2","title":"Never enough","date":"2013-03-11 05:40:00","body":"<div xmlns=\"http://www.w3.org/1999/xhtml\"><p>There's never enough time to be as patient as we need to be. Not enough slack to focus on the long-term, too much urgency in the now to take the time and to plan ahead. That urgent sign post just ahead demands all of our intention (and attention), and we decide to invest in, \"down the road,\" down the road. </p>\r\n<p>It's not only more urgent, but it's easier to run to the urgent meeting than it is to sit down with a colleague and figure out the truth of what matters and the why of what's before us.</p>\r\n<p>And there's never enough money to easily make the investments that matter. Not enough surplus in the budget to take care of those that need our help, too much on our plate to be generous right now. The short term bills make it easy to ignore the long-term opportunities.</p>\r\n<p>Of course, the organizations that get around the universal and insurmountable problems of not enough time and not enough money are able to create innovations, find resources to be generous and prepare for a tomorrow that's better than today. It's not easy, not at all, but probably (okay, certainly) worth it.</p>\r\n<p>We're going to spend our entire future living in tomorrow—investing now, when it's difficult, is the single best moment.</p></div><div class=\"feedflare\">\n<a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=A1bcDgGzfEM:Ob7Ff4sMp7g:yIl2AUoC8zA\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=yIl2AUoC8zA\" border=\"0\"></img></a> <a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=A1bcDgGzfEM:Ob7Ff4sMp7g:qj6IDK7rITs\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=qj6IDK7rITs\" border=\"0\"></img></a>\n</div><img src=\"http://feeds.feedburner.com/~r/typepad/sethsmainblog/~4/A1bcDgGzfEM\" height=\"1\" width=\"1\"/>","read":"0"},{"id":"30","feed_id":"2","title":"Connected, portable or aware","date":"2013-03-10 05:00:00","body":"<div xmlns=\"http://www.w3.org/1999/xhtml\"><p>There's a little bit of a rush to bring content into app form. It's so easy to make an ebook and cram it with videos, or to turn your how-to guide into something that looks slick on an iPad. I think of these electronic projects as the new coffee table books. Beautiful, but unfortunately, not widely read.</p>\r\n<p>The problem is this: when you turn this work into an app or augmented ebook, you're not moving to a less crowded market, not moving to a place where you will earn more attention from strangers. In fact, unless your app is connected, portable and/or aware, the only people who are likely to use it are people who were already your fans. (Not that there's anything wrong with that, if that's your goal.)</p>\r\n<p>Connected: the app works better when other people are also using it. Like the fax machine (what did the first owner of a fax do with it?), these apps have a hurdle at first, but get more and more appealing as the word spreads. Instagram and Twitter are connected.</p>\r\n<p>Portable: sure, PDFs and paper books are portable, but there are certain forms of content where having the content in your pocket is really useful. I'd put frequently updated, timely content (like the weather) or content I'll need to refer to again and again on this list.</p>\r\n<p>Aware: Our mobile devices know where we are, and in some cases, know what we've just done. Telematics opens the door to a huge number of breakthroughs, only a few of which we've seen exploited to date. </p>\r\n<p>Slick is not the goal. I know that apps are shiny and new and sexy, but if your goal is impact, you'll need at least one of these three elements--or you're better off in a different format. More than a decade later, email and free-to-share digital text and video remain killer apps if you're trying to spread the word.</p></div><div class=\"feedflare\">\n<a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=HNcr-B80tC4:AAVVTLnuVGM:yIl2AUoC8zA\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=yIl2AUoC8zA\" border=\"0\"></img></a> <a href=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?a=HNcr-B80tC4:AAVVTLnuVGM:qj6IDK7rITs\"><img src=\"http://feeds.feedburner.com/~ff/typepad/sethsmainblog?d=qj6IDK7rITs\" border=\"0\"></img></a>\n</div><img src=\"http://feeds.feedburner.com/~r/typepad/sethsmainblog/~4/HNcr-B80tC4\" height=\"1\" width=\"1\"/>","read":"0"},{"id":"13","feed_id":"3","title":"Rob’s Sprint: The cost of getting data from LevelDB","date":"2013-03-08 10:00:00","body":"<p>We are currently investigating the usage of <a href=\"http://code.google.com/p/leveldb/\">LevelDB</a> as a storage engine in RavenDB. Some of the things that we feel very strongly about is transactions (LevelDB doesn’t have it) and performance (for a different definition of the one usually bandied about).</p> <p>LevelDB does have atomicity, and the rest of CID can be built atop of that without too much complexity (already done, in fact). But we run into an issue when looking at the performance of reading. I am not sure if that is unique or not, but in our scenario, we typically deal with relatively large values. Documents of several MB are quite common. That means that we are pretty sensitive to memory allocations. It doesn’t help that we have very little control on the Large Object Heap, so it was with great interest that we looked at how LevelDB did things.</p> <p>Reading the actual code make a lot of sense (more on that later, I will probably go through a big review of that). But there was one story that really didn’t make any sense to us, reading a value by key.</p> <p>We started out using <a href=\"https://github.com/meebey/leveldb-sharp\">LevelDB Sharp</a>:</p> <blockquote> <p>Database.Get(\"users/1\");</p></blockquote> <p>This in turn result in the following getting called:</p> <p><a href=\"http://ayende.com/blog/Images/Windows-Live-Writer/The-cost-of_9C42/image_2.png\"><img style=\"background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/The-cost-of_9C42/image_thumb.png\" width=\"751\" height=\"631\"></a></p> <p>A few things to note here. All from the point of view of someone who deals with very large values.</p> <ul> <li>valuePtr is not released, even though it was allocated by us.</li> <li>We copy the value from valuePtr into a string, resulting in two copies of the data and twice the memory usage.</li> <li>There is no way to get just partial data.</li> <li>There is no way to get binary data (for example, encrypted)</li> <li>This is going to be putting a lot of pressure on the Large Object Heap.</li></ul> <p>But wait, it actually gets better. Let us look at the LevelDB method that get called:</p> <p><a href=\"http://ayende.com/blog/Images/Windows-Live-Writer/The-cost-of_9C42/image_4.png\"><img style=\"background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/The-cost-of_9C42/image_thumb_1.png\" width=\"739\" height=\"372\"></a></p> <p>So we are actually copying the data multiple times now. For fun, the db-&gt;rep-&gt;Get() call <em>also </em>copy the data. And that is pretty much where we stopped looking.</p> <p>We are actually going to need to write a new C API and export <em>that</em> to be able to make use of that in our C# code. Fun, or not.</p>","read":"0"},{"id":"14","feed_id":"3","title":"Rob’s Sprint: Result Transformers","date":"2013-03-07 10:00:00","body":"<p>By far the most confusing feature in RavenDB has been the index’s Transform Result. We introduced this feature to give the user the ability to do server side projections, including getting data from other documents. </p> <p>Unfortunately, when we introduced this feature, we naturally added it to the index, and that cause a whole <em>lot</em> of confusion. In particular, people seemed to have a very hard time distinguishing between what get indexed and is searchable and the output of the index. To make matters worse, we also had major issues with how to determine the<em> input</em> of the TransformResults function. In short, the entire thing works, but from the point of view of an external user, that is really something that is very finicky and hard to get.</p> <p>Instead, during Rob’s sprint, we have introduced a totally new concept. Stand-alone Result Transformers.</p> <p>Here is what they look like:</p> <blockquote><pre class=\"csharpcode\"><span class=\"kwrd\">public</span> <span class=\"kwrd\">class</span> OrdersStatsTransfromer : AbstractTransformerCreationTask&lt;Order&gt;\n{\n    <span class=\"kwrd\">public</span> OrdersStatsTransfromer()\n    {\n        TransformResults = orders =&gt;\n                           from order <span class=\"kwrd\">in</span> orders\n                           select <span class=\"kwrd\">new</span>\n                           {\n                               order.OrderedAt,\n                               order.Status,\n                               order.CustomerId,\n                               CustomerName = LoadDocument&lt;Customer&gt;(order.CustomerId).Name,\n                               LinesCount = order.Lines.Count\n                           };\n    }\n}</pre>\n<style type=\"text/css\">.csharpcode, .csharpcode pre\n{\n\tfont-size: small;\n\tcolor: black;\n\tfont-family: consolas, \"Courier New\", courier, monospace;\n\tbackground-color: #ffffff;\n\t/*white-space: pre;*/\n}\n.csharpcode pre { margin: 0em; }\n.csharpcode .rem { color: #008000; }\n.csharpcode .kwrd { color: #0000ff; }\n.csharpcode .str { color: #006080; }\n.csharpcode .op { color: #0000c0; }\n.csharpcode .preproc { color: #cc6633; }\n.csharpcode .asp { background-color: #ffff00; }\n.csharpcode .html { color: #800000; }\n.csharpcode .attr { color: #ff0000; }\n.csharpcode .alt \n{\n\tbackground-color: #f4f4f4;\n\twidth: 100%;\n\tmargin: 0em;\n}\n.csharpcode .lnum { color: #606060; }\n</style>\n</blockquote>\n<p>And yes, they are quite intentionally modeled to be very similar to the way you would define them up to now, but outside of the index.</p>\n<p>Now, why is that important? Because now you can <em>apply</em> a Transform Results on the <em>server side</em> without being tied to a customer.</p>\n<p>For example, let us see how we can make use of this new feature:</p>\n<blockquote><pre class=\"csharpcode\">var customerOrders = session.Query&lt;Order&gt;()\n    .Where(x =&gt; x.CustomerId == <span class=\"str\">\"customers/123\"</span>)\n    .TransformWith&lt;OrdersStatsTransfromer, OrderViewModel&gt;()\n    .ToList();\n</pre>\n<style type=\"text/css\">.csharpcode, .csharpcode pre\n{\n\tfont-size: small;\n\tcolor: black;\n\tfont-family: consolas, \"Courier New\", courier, monospace;\n\tbackground-color: #ffffff;\n\t/*white-space: pre;*/\n}\n.csharpcode pre { margin: 0em; }\n.csharpcode .rem { color: #008000; }\n.csharpcode .kwrd { color: #0000ff; }\n.csharpcode .str { color: #006080; }\n.csharpcode .op { color: #0000c0; }\n.csharpcode .preproc { color: #cc6633; }\n.csharpcode .asp { background-color: #ffff00; }\n.csharpcode .html { color: #800000; }\n.csharpcode .attr { color: #ff0000; }\n.csharpcode .alt \n{\n\tbackground-color: #f4f4f4;\n\twidth: 100%;\n\tmargin: 0em;\n}\n.csharpcode .lnum { color: #606060; }\n</style>\n</blockquote>\n<p>This separation between the result transformer and the index means that we can apply it to things like automatic indexes as well. </p>\n<p>In fact, we can apply it during <em>load</em>:</p>\n<blockquote><pre class=\"csharpcode\">var ovm = session.Load&lt;OrdersStatsTransfromer, OrderViewModel&gt;(<span class=\"str\">\"orders/1\"</span>);</pre>\n<style type=\"text/css\">.csharpcode, .csharpcode pre\n{\n\tfont-size: small;\n\tcolor: black;\n\tfont-family: consolas, \"Courier New\", courier, monospace;\n\tbackground-color: #ffffff;\n\t/*white-space: pre;*/\n}\n.csharpcode pre { margin: 0em; }\n.csharpcode .rem { color: #008000; }\n.csharpcode .kwrd { color: #0000ff; }\n.csharpcode .str { color: #006080; }\n.csharpcode .op { color: #0000c0; }\n.csharpcode .preproc { color: #cc6633; }\n.csharpcode .asp { background-color: #ffff00; }\n.csharpcode .html { color: #800000; }\n.csharpcode .attr { color: #ff0000; }\n.csharpcode .alt \n{\n\tbackground-color: #f4f4f4;\n\twidth: 100%;\n\tmargin: 0em;\n}\n.csharpcode .lnum { color: #606060; }\n</style>\n</blockquote>\n<p>There are a whole bunch of other goodies in there, as well. We made sure that now you don’t have to worry about the inputs to the transform. We will automatically use the right values when you access them, based on whatever you stored the field in the index or if it is accessible on the document.</p>\n<p>All in all, this is a very major step forward, and it makes it drastically easier to use Result Transformers in various ways.</p>","read":"0"},{"id":"15","feed_id":"3","title":"Rob’s Sprint: Query optimizer jumped a grade","date":"2013-03-06 10:00:00","body":"<p>RavenDB’s query optimizer is pretty smart, it knows how to find the appropriate index for your queries, and even create a new index to match your query if it didn’t exist. But that was the limits of its abilities. A human could still go into the database and say, look at those:</p> <p><a href=\"http://ayende.com/blog/Images/Windows-Live-Writer/Robs-Sprint-Query-optimizer-jumped-a-gra_A6FB/image_2.png\"><img style=\"background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/Robs-Sprint-Query-optimizer-jumped-a-gra_A6FB/image_thumb.png\" width=\"453\" height=\"168\"></a></p> <p>Those all operate on Posts, and you should be able to merge them all into a single index. Reducing the number of indexes is a good thing, as it reduces the amount of IO on the system, which is typically our limiting factor.</p> <p>Now, there was no real reason why we couldn’t actually tell the query optimizer that it should be smart enough that when it creates a new index, it will use all of the properties that have been previously indexed.</p> <p>However, doing so would actually make no difference to us. Because until now, we didn’t have a way to <em>stop </em>an index. With the new index idling feature, we can now have the query optimizer create a new merged index, and then the database will just mark the extra index as idle after a while.</p> <p>Almost, there is still another issue that we have to resolve. What happens when we have a big database, and we introduce a new (and wider) index? By default, all matching queries would actually hit that index, and not the previously existing index. That is great, except… the new index is stale, and might <em>remain</em> stale for a few minutes. During that time, we have a perfectly servicable index that is just sitting there.</p> <p>The query optimizer can now take into account the staleness level of an index as well when selecting it, meaning that there should be no interruption from the point of view of other queries. The new index will be introduced, go through all the documents, and then take over as the serving index for all queries. The existing index will wither away and die.</p>","read":"0"},{"id":"16","feed_id":"3","title":"Rob’s Sprint: Faster index creation","date":"2013-03-05 10:00:00","body":"<p>RavenDB previously had a really nice feature for temporary indexes. Since we expected most of them to be temporary, we indexed them directly into memory, greatly saving in IO costs. With the removal of temporary indexes, that left us the option of just removing the entire code path and moving on to other things.</p> <p>But we sat down and thought about this for a while. Typically, the busiest part in the index’s life is its creation, because the database needs to go through all the documents in the db and index them. We have changed things so during this creation period, we will actually index to memory, without hitting the disk. Only if we reached a configurable size or finished indexing everything will we spill everything to disk.</p> <p>This, in turn, gives us the best of both worlds. We get a really nice optimization for new indexes, and we don’t have to hit the disk for indexes that would soon go away. And, of course, we get the perf boost for all indexes now.</p>","read":"0"},{"id":"17","feed_id":"3","title":"Rob’s Sprint: Indexes and the death of temporary indexes","date":"2013-03-04 10:00:00","body":"<p>RavenDB’s ability to analyze your queries and generate the required indexes on the fly has always been a great boon. <a href=\"http://codeofrob.com\">Rob Ashton</a> was involved in the original implementation and during his visits to Hibernating Rhinos’ secret lair, he got to whack that thing on the head a few more times.</p> <p>We need to separate two important things:</p> <ul> <li>Automatically generating the indexes based on your queries.</li> <li>The temporary indexes model itself.</li></ul> <p>The first part is a really important feature. The second is just an implementation detail. In particular, temporary indexes had a few problems.</p> <p>Most importantly, they were temporary, and there was an explicit step for promoting those indexes from one stage to the other. That caused some confusion, and there was a period of time, exactly when we decided that the index was important enough to keep, that caused the index to effectively reset itself. The other problem was that the moment that an index was upgraded to an auto index, it was there forever.</p> <p>What Rob has done was to remove the concept of temporary indexes all together, which got rid of a <em>whole</em> bunch of code. Instead, we have just standard auto indexes. And now we had a drastically simplified story. We didn’t have the drastic jump from temp to auto, with irrecoverable implications.</p> <p>Of course, this leads to a lot of interesting questions. Temporary indexes had the benefit of being indexed directly to memory, and they would go away after a database restart, as well as a whole lot of stuff. Not having special code for that made things a lot simpler for us, actually.</p> <p>Automatic indexes have their age, and that is tracked internally by RavenDB. If an automatic indexed isn’t being used, it will become idle an eventually abandoned. If it is a very young index, we will decide it was a temporary index after all, and remove it from the system completely.</p> <p>This feature, along with idling indexes, opened up the door for the next important feature, index merging. But before that, we need to upgrade the smarts for the query optimizer… which happens to be our next topic.</p>","read":"0"},{"id":"18","feed_id":"3","title":"LevelDB & Windows: It ain’t a love story","date":"2013-03-01 05:36:00","body":"<p>I have been investigating <a href=\"http://code.google.com/p/leveldb\">the LevelDB project</a> for the purpose of adding another storage engine to RavenDB. The good news is that there is a very strong likelihood that we can actually use that as a basis for what we want.</p> <p>The bad news is that it is <em>insanely </em>easy to get LevelDB to compile and work on Linux, and appears to be an insurmountable barrier to do the same on Windows.</p> <p>Yes, I know that I can get it working by just using a precompiled binary, but that won’t work. I actually want to make some changes there (mostly in the C API, right now).</p> <p><a href=\"http://code.google.com/p/leveldb/source/browse/WINDOWS?name=windows\">This instructions</a> appears to be no longer current. And <a href=\"http://groups.google.com/group/leveldb/browse_thread/thread/56e10264c9eca1be/f5316e4f1815fc79\">this thread</a> was promising, but didn’t lead anywhere.</p> <p>I am going to go over the codebase with a fine tooth comb, but I am no longer a C++ programmer, and the intricacies of the build system is putting a very high roadblock of frustration.</p>","read":"0"},{"id":"19","feed_id":"3","title":"Rob’s Sprint: Idly indexing","date":"2013-02-28 10:00:00","body":"<p>During <a href=\"http://codeofrob.com\">Rob Ashton</a>’s visit to our <a href=\"https://maps.google.com/maps?q=Komba+10,+Hadera,+Israel&amp;hl=en&amp;ll=32.446442,34.910871&amp;spn=0.008321,0.016512&amp;sll=32.446112,34.910976&amp;layer=c&amp;cbp=13,164.11,,0,9.03&amp;cbll=32.446335,34.910901&amp;hnear=Komba+10,+Hadera,+Israel&amp;t=m&amp;z=17&amp;iwloc=A&amp;panoid=xVMXyGknp1lzY10CJKSUhg\">secret lair</a>, we did some work on hard problems. One of those problems was the issue of <a href=\"http://ayende.com/blog/161123/index-prioritization-in-ravendb-problems?key=82067d359db44523b80fbc426b4adf7c\">index prioritization</a>. As I have discussed before, this is something that isn’t really easy to do, because of the associated IO costs with <em>not</em> indexing properly.</p> <p>With Rob’s help, we have the defined the following:</p> <ul> <li>An auto index can be set to idle if it hasn’t been queried for a time.</li> <li>An index can be forced to be idle by the user.</li> <li>An index that was automatically set to idle will be set to normal on its first query.</li></ul> <p>What are the implications for that? And idle index will <em>not</em> be indexed by RavenDB during the normal course of things. Only when the database is idle for a period of time (by default, about 10 minutes with no writes) will we actually get it indexing.</p> <p>Idle indexing will continue indexing as long as there is no other activity that require their resources. When that happens, they will complete their current run and continue to wait for the database to become idle again.</p> <p>But wait, there is more. In addition to introducing the notion of idle indexes, we have also created another two types of indexes. The first is pretty obvious, the disabled index will use no system resources and will never take part in indexing. This is mostly there so you can manually shut down a single index. For example, maybe it is a very expensive one and you want to stop it while you are doing an import.</p> <p>More interesting, however, is the concept on an abandoned index. Even idle indexes can take some system resources, so we have added another level beyond that, an abandoned index is one that hasn’t been queried in 72 hours. At that point, RavenDB is going to avoid indexing it even during idle periods. It will still get indexed, but only if there has been a long enough time passed since the last time it was indexed.</p> <p>Next, we will discuss why this feature was a crucial step in the way to killing temporary indexes.</p>","read":"0"},{"id":"20","feed_id":"3","title":"Rob’s RavenDB Sprint","date":"2013-02-27 10:00:00","body":"<p><a href=\"http://codeofrob.com/\">Rob Ashton</a> is a great developer.&nbsp;&nbsp; We invited him to Hibernating Rhinos as part of his <a href=\"http://codeofrob.com/entries/i-am-not-looking-for-a-job.html\">Big World Tour</a>.&nbsp; I had the chance to work with him in the past on RavenDB, and I really liked working with him, and I liked the output even better. So we prepared some stuff for him to do. </p> <p>This is the status of those issues midway through the second day.</p> <p><a href=\"http://ayende.com/blog/Images/Windows-Live-Writer/Robs-RavenDB-Sprint_CF72/image_4.png\"><img style=\"background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http://ayende.com/blog/Images/Windows-Live-Writer/Robs-RavenDB-Sprint_CF72/image_thumb_1.png\" width=\"903\" height=\"967\"></a></p>  <p>And yes, I am giddy.</p>","read":"0"},{"id":"31","feed_id":"1","title":"Glamorous pictures?","date":"2011-03-02 07:43:09.362","body":"<a onblur=\"try {parent.deselectBloggerImageGracefully();} catch(e) {}\" href=\"http://2.bp.blogspot.com/-gx9KQhITQCg/TW5iPNYRi5I/AAAAAAAAABA/ONZ1OwliW7g/s1600/1994-May-NewOrleans-Linus-Linux-MediumRes.jpeg\"><img style=\"display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 227px;\" src=\"http://2.bp.blogspot.com/-gx9KQhITQCg/TW5iPNYRi5I/AAAAAAAAABA/ONZ1OwliW7g/s320/1994-May-NewOrleans-Linus-Linux-MediumRes.jpeg\" border=\"0\" alt=\"\" id=\"BLOGGER_PHOTO_ID_5579505001787657106\" /></a>The event last weekend was a \"no cameras\" event, and while we'll have pictures, I don't have them yet. <div><br /></div><div>And I think I'll keep them private when we get them - no need to embarrass the beautiful people any more than we already did.</div><div><br /></div><div>So to make up for that, here's a glamorous shot from about seventeen years ago that maddog (on the left) found the other day. It's from DECUS, New Orleans, 1994.</div><div><br /></div><div>As you can tell, I knew how to party back then too. I'm the handsome young man on the right, in case you couldn't guess.</div><div><br /></div><div>They called me \"The Stud\".</div>","read":"0"},{"id":"32","feed_id":"1","title":"Pearls before swine..","date":"2011-02-28 10:50:41.188","body":"My life isn't glamorous. <div><br /></div><div>I know that comes as a big shock to everybody, since geeks in general are seen as the crème de la crème of society, and the common perception is that we live the life of rock-stars and party all night with all the other glamorous people.</div><div><br /></div><div>Not so.</div><div><br /></div><div>I sit in my office (which used to be in the basement, now it's a room above the garage), usually in my ratty bathrobe, reading and writing email all day. And a lot of wasting time while waiting for people to answer or just report problems. I go to bed at ten, and wake up at seven to get the kids to school. And then it all repeats.</div><div><br /></div><div>So not glamorous. When I actually write code (which is usually in the mail reader these days - mostly telling people \"do it like this\" rather than actually writing real code), that's about the most exciting part of the day.</div><div><br /></div><div>But then, once in a while, I get to live the high life. This weekend, we got invited to the Night Before Oscar party (thanks Renée and Doug!) because sometimes the companies I work with apparently think that I need to get a night out. </div><div><br /></div><div>Toto, I don't think we're talking white-socks-and-sandals any more.</div><div><br /></div><div>So me and the wife were completely out of our depth, and knew absolutely nobody. We go out for a date night every week, so we a fair number of movies, but we really aren't movie people - the kinds of movies we go to don't make a huge impression. So there we were, cram-packed with celebrities, not remembering names or faces.</div><div><br /></div><div>The good news was, that as Tove said, there was no real downside. Nobody knew us, and nobody would ever remember us the next day. So we could go whole retard quite openly, and brazenly just ask people \"You look really familiar, who are you?\". Which we did. With some discreet google image searches when we could guess, and just wanted to verify it (\"John Cusack or Paul Rudd?\").</div><div><br /></div><div>Everybody seemed to take it in good cheer. We interrupted David Spade chatting up Natalie Portman and Mila Kunis (that's what Tove says, I was oblivious - it's those famous geek social graces again. I told her I'm <i>sure</i> I'd have noticed Natalie Portman and that she can't possibly have been there, but whatever), and Tove pissed off Warren Beatty by asking his name not just once, but <i>twice</i>. </div><div><br /></div><div>So here's a shout-out to my new BFF's Jon Hamm and DJ.</div><div><br /></div><div>We probably won't be invited again. But we have pictures for the kids, to prove to them that their parents are cool people.</div>","read":"0"},{"id":"33","feed_id":"1","title":"Thank you for ...","date":"2010-12-06 11:51:21.927","body":"The kids all got their black belts in TKD a couple of weeks ago, and what do I find in the mailbox today if it isn't their \"thank you\" notes that they apparently wrote as part of that whole experience.<div><br /></div><div>(Side note: they put them in the mail without any stamps. So the USPS happily returned them to the sender address - the kids' - which obviously happened to be the same as the actual destination. Either there's somebody at the USPS that goes \"Aww, how cute, more clueless children in action\", or I can see a gaping hole in the USPS business plan)<br /><div><br /></div><div>And I'm starting to see a pattern about this whole \"thank you\" business. I blogged about a similar event last year (\"Parenting gold star (?)\") where Celeste - under similar forced circumstances - was thanking us for being such great parents and not flushing their dead pets down the toilet.</div><div><br /></div><div>This time around, she apparently had an even harder time to figure out what to thank us for. Because this is what she says: \"Thank you for caring enough to feed me\". Yes, there's more, but that's the opening line. Wow. We're really top-notch parents. Because we <i>care just enough</i> to feed our kids!</div><div><br /></div><div>Apparently childhood in the Torvalds family is a tough affair. There's this constant nagging worry about the parents caring enough that the kids are being fed. Only to be occasionally overshadowed by the terror of dead pets being flushed.</div></div>","read":"0"},{"id":"34","feed_id":"1","title":"Early Halloween Guest","date":"2010-10-13 13:05:04.951","body":"<a onblur=\"try {parent.deselectBloggerImageGracefully();} catch(e) {}\" href=\"http://2.bp.blogspot.com/_7IBIy_MGpV4/TLYPMrzPkdI/AAAAAAAAAAM/gFIxzm3zAto/s1600/bat.jpg\"><img style=\"display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 240px;\" src=\"http://2.bp.blogspot.com/_7IBIy_MGpV4/TLYPMrzPkdI/AAAAAAAAAAM/gFIxzm3zAto/s320/bat.jpg\" border=\"0\" alt=\"\" id=\"BLOGGER_PHOTO_ID_5527622303234363858\" /></a>It's not the greatest picture ever taken in the history of man-kind, but that blurry thing inside the plastic container is a small cute bat being very angry at being caught.  The rock face is the fireplace in the kids playroom.<div><br /></div><div>You can kind of see the mouth and the three-inch-long fangs bared, ready to spill the blood of its captors. What you cannot hear is the furious roaring of its mighty mouth, but if you mentally visualize the old MGM Lion, you can kind of imagine what it didn't sound like. <div><br /></div><div>I have no idea how it actually got into our house, but with a graceful flick of the red construction paper, I got it just barely out the door, and it flew away.</div></div><div><br /></div><div>Bye bye, little bat.</div>","read":"0"},{"id":"35","feed_id":"1","title":"\"13744 supplied\"","date":"2010-08-03 13:28:14.755","body":"Yeah, I'm not talking about the number of burgers McD supplies each second or anything like that. No, I'm talking about our fully automatic coffee maker. I just did a cleaning cycle, and ended up looking up what the coffee count was.<div><br /></div><div>I may have an addiction problem.</div><div><br /></div><div>Now, admittedly this is a coffee maker that we've had for something like 8 years, but that's still 4.7 doubleshots of coffee supplied <i>every day</i> for those eight years (you can ask for a single or a double, and the counter just counts \"events\").</div><div><br /></div><div>Ok, I lie. The coffee maker counts the different types of coffee it makes separately, and \"only\" about two thirds of the events are actually double-shots. But I make that up by still supporting Starbucks (and Peet's) enough to make up the difference. And Tove accounts for about half, so when I say that I have an addiction problem, I should probably have said \"we\".</div><div><br /></div><div>So every time I see some piece of medical research saying that caffeine is good for you, I high-five myself. Because I'm going to live forever.</div>","read":"0"},{"id":"36","feed_id":"1","title":"Meanwhile, in Finland..","date":"2010-05-29 11:34:27.463","body":"Being known as a Finn living in the US, sometimes people send me pointers to things Finnish.<div><br /></div><div>Now, this weekend is obviously the <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_0\">Eurovision</span> song contest (you all knew that, right?).  And I expect Finland to do as well as it usually does (\"Finland, <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_1\">nul</span> point\" - it's a national tradition!), and you can spend up to several minutes on <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_2\">youtube</span> transfixed by the glory, or just start from the official <a href=\"http://www.eurovision.tv/page/home\">home page</a>.</div><div><br /></div><div>But before that glorious tradition had time to take off, Tim Elliott sent me this gem of Finnish culture seen from the outside: the <a href=\"http://sports.espn.go.com/espn/news/story?id=5198604\">sauna championships</a>. </div><div><br /></div><div><div>What can I say? We have a sauna in our house. Even if we don't use it all <i>that</i> often, it's a Finnish thing.</div></div><div><br /></div>","read":"0"},{"id":"37","feed_id":"1","title":"A Pig Lover's Oath","date":"2010-05-16 12:14:28.733","body":"<div style=\"text-align: center;\"></div><blockquote><div style=\"text-align: center;\">I honor and love</div><div style=\"text-align: center;\">Every pig that I see</div><div style=\"text-align: center;\">For maybe one day</div><div style=\"text-align: center;\">That pig will love me.</div><div style=\"text-align: center;\"><br /></div><div style=\"text-align: center;\">Our friendship with pigs</div><div style=\"text-align: center;\">will always last</div><div style=\"text-align: center;\">It doesn't matter</div><div style=\"text-align: center;\">Whether it's slow or fast.</div><div style=\"text-align: center;\"><br /></div><div style=\"text-align: center;\">If we continue to hug</div><div style=\"text-align: center;\">Every pig we can</div><div style=\"text-align: center;\">Our love will grow</div><div style=\"text-align: center;\">As large as this land.</div><div style=\"text-align: center;\"><br /></div><div style=\"text-align: center;\">So I promise to help</div><div style=\"text-align: center;\">Every pig in defeat</div><div style=\"text-align: center;\">For if it weren't for pigs</div><div style=\"text-align: center;\">There would be no bacon to eat.</div><div style=\"text-align: justify;\"><br /></div><div style=\"text-align: justify;\">What can I say? Daniela (my middle one) is a real poet. It scans a bit oddly, but I think that falls solidly under the heading of \"artistic\".</div></blockquote><div style=\"text-align: justify;\"><br /></div>","read":"0"},{"id":"38","feed_id":"1","title":"Silly grin","date":"2010-03-31 13:28:50.091","body":"<a onblur=\"try {parent.deselectBloggerImageGracefully();} catch(e) {}\" href=\"http://1.bp.blogspot.com/_E2tJnrV_I64/S7Outqq14HI/AAAAAAAAACE/Q_cj92_3c00/s1600/linus-and-seadragon.jpg\"><img style=\"margin: 0px auto 10px; display: block; text-align: center; cursor: pointer; width: 320px; height: 214px;\" src=\"http://1.bp.blogspot.com/_E2tJnrV_I64/S7Outqq14HI/AAAAAAAAACE/Q_cj92_3c00/s320/linus-and-seadragon.jpg\" alt=\"\" id=\"BLOGGER_PHOTO_ID_5454895673247129714\" border=\"0\" /></a>This is actually from last year (LCA in Tasmania), but Oscar, who took the picture, was diving around the world for many months and only made the pictures he took available to me the other day. I thought I had a good life, but Oscar and Annemarie clearly has this whole life thing figured out.<br /><br />Those weedy sea-dragons are pretty cool. And they weren't the only cool thing there, if you get my meaning. Brrr. I prefer warm water diving.","read":"0"},{"id":"39","feed_id":"1","title":"Turst me, I know what I'm doing...","date":"2010-02-24 10:38:24.059","body":"<a onblur=\"try {parent.deselectBloggerImageGracefully();} catch(e) {}\" href=\"http://2.bp.blogspot.com/_E2tJnrV_I64/S4VpnqE8RwI/AAAAAAAAAB8/Xr0l5iPzLCk/s1600-h/HouseHub.jpg\"><img style=\"margin: 0px auto 10px; display: block; text-align: center; cursor: pointer; width: 209px; height: 320px;\" src=\"http://2.bp.blogspot.com/_E2tJnrV_I64/S4VpnqE8RwI/AAAAAAAAAB8/Xr0l5iPzLCk/s320/HouseHub.jpg\" alt=\"\" id=\"BLOGGER_PHOTO_ID_5441871854777943810\" border=\"0\" /></a><br />I'm probably moving my office to be above the garage.<br /><br />In preparation for that, I did the whole \"get CAT6 networking to the new location\" thing, which has involved re-acquainting myself with our crawlspace. Spending my days crawling around, hoping I'm not going to encounter any dead mice (or live ones, for that matter).<br /><br />I obviously already had cable going to various locations in the house, but the way that had happened, I'd done them one at a time, and my current office ended up being the hub for it all. And since I really wasn't going to re-route all the cables and make the new office be another hub of chaos, and I certainly wasn't going to leave the hub in what will become a kids bedroom, the above is the result.<br /><br />Beautiful it ain't. It's a real media center enclosure, but the networking hubs that are meant for those things are overpriced and generally just pitiful 4-port 100Mbps switches with dubious firewall capabilities, so I'm just installing my own. And some day, I'll actually add the screws that hold the boxes where they are supposed to go, rather than just sitting in a pile on top of each other at the bottom of the box.<br /><br />I haven't had the energy to fix the telephone wiring. As you can see, I now have the header for getting that particular mess sorted out too, but I'm not the person who created that particular \"rat king\" of cabling under our house in the first place. So I'm not feeling the need quite acutely enough to spend another few hours crawling around straightening out all <span style=\"font-style: italic;\">that</span> wiring. Same goes for TV cabling. You can kind of tell what part of the house wiring I actually care about...","read":"0"},{"id":"40","feed_id":"1","title":"Demons? Really?","date":"2010-02-19 11:51:51.656","body":"So I was in Costco waiting for a car tire rotation and check yesterday. Wasting time, I blew three bucks on a slice of pizza and a sundae, and looked around for a place to sit down and pig out. The place was packed, and it was the middle of the day.<br /><br />So I sat down next to this group of people, and realized that one reason it was busy was that apparently people use the Costco foodcourt as a lunch place. Fair enough. A couple of bucks gets you a long way there.<br /><br />Sitting there, I can't but help overhear that it's apparently some religious discussion going on. Ok, so it's the local God Squad having their lunch meeting, no biggie. They're apparently talking about Africa, and about life and death decisions etc - at least one of them is a missionary.<br /><br />And that's when it gets strange. One of them starts to seriously talk about praying demons away, and then after the prayer has driven the demon out of the person, you have to support the person so that the demon doesn't come back. And nobody laughs at him.<br /><br />Seriously? What year is it again? I'm pretty sure they didn't have Costco foodcourts in the middle ages, but maybe there was some time warping going on.<br /><br />What the hell is <span style=\"font-style: italic;\">wrong</span> with people?","read":"0"},{"id":"41","feed_id":"1","title":"Happy camper","date":"2010-02-06 13:22:03.951","body":"I broke down and bought a Nexus One last week.<br /><br />I got the original G1 phone from google when it came out, and I hardly ever used it. Why? I generally hate phones - they are irritating and disturb you as you work or read or whatever - and a cellphone to me is just an opportunity to be irritated wherever you are. Which is not a good thing.<br /><br />At the same time I love the <span style=\"font-style: italic;\">concept</span> of having a phone that runs Linux, and I've had a number of them over the years (in addition to the G1, I had one of the early China-only Motorola Linux phones) etc. But my hatred of phones ends up resulting in me not really ever using them. The G1, for example, ended up being mostly used for playing Galaga and Solitaire on long flights, since I had almost no reason to carry it with me except when traveling.<br /><br />But I have to admit, the Nexus One is a winner. I wasn't enthusiastic about buying a phone on the internet sight unseen, but the day it was reported that it finally had the pinch-to-zoom thing enabled, I decided to take the plunge. I've wanted to have  a GPS unit for my car anyway, and I thought that google navigation might finally make a phone useful.<br /><br />And it does. What a difference! I no longer feel like I'm dragging a phone with me \"just in case\" I would need to get in touch with somebody - now I'm having a useful (and admittedly pretty good-looking) gadget instead. The fact that you can use it as a phone too is kind of secondary.","read":"0"},{"id":"42","feed_id":"1","title":"Embroidery.. gaah","date":"2010-01-13 16:00:19.834","body":"<a onblur=\"try {parent.deselectBloggerImageGracefully();} catch(e) {}\" href=\"http://4.bp.blogspot.com/_E2tJnrV_I64/S05XHnoFF3I/AAAAAAAAAB0/BO_iewdVt5o/s1600-h/s512.png\"><img style=\"margin: 0px auto 10px; display: block; text-align: center; cursor: pointer; width: 320px; height: 302px;\" src=\"http://4.bp.blogspot.com/_E2tJnrV_I64/S05XHnoFF3I/AAAAAAAAAB0/BO_iewdVt5o/s320/s512.png\" alt=\"\" id=\"BLOGGER_PHOTO_ID_5426370389435815794\" border=\"0\" /></a><br />So for Christmas, Tove got this embroidery machine from Santa Claus. Since then, she's busily been filling the kids clothes with names, re-doing their Tae-Kwon-Do uniforms etc etc.<br /><br />And why do I care?  It turns out that all those embroidery machines can be extended with new patterns, and most of them - including the one Tove has - seem to use this special and pretty much undocumented \"PES\" format that was designed by Brother. So Tove has been buying embroidery patterns, but actually seeing them on the computer and transferring them to the sewing machine is a big pain.<br /><br />So the above beautiful png file is what I did today. It's the result of me doing a thumbnailer for those PES files (and yes, \"PES\" stands for \"PESky\", I'm convinced), so that Tove can see the designs in her file manager as she moves them around.<br /><br />I can read them (largely thanks to converting a <a href=\"http://bobosch.dyndns.org/embroidery/showFile.php?pes.php\">php script</a> written by Robert Heel - which in turn seems to be based on a GPL C# project from <a href=\"http://www.njcrawford.com/embroidery-reader/\">njcrawford.com</a> - into C code) and then drawing them and writing the result out as a png out with cairo. Sadly, it seems that the embroidery machine itself sometimes has a rather harder time. When uploading the designs to the machine, a number of them just say \"Data Error\", which is very annoying.<br /><br />I wonder what those embroidery machine firmware people were thinking. No diagnostics, no nothing. If a design is too large for the hoop of the machine, the machine accepts it (no \"Data Error\"), but doesn't actually show or use the design - it just silently ignores it.<br /><br />Whee. Undocumented formats, bad firmware, lack of sane error messages.  And did I mention crazy interfaces? The embroidery machine itself shows up as a USB storage device when you connect it, except it for some reason takes about half a minute to calm down enough to be mounted. And forget about the embroidery card reader/writer - that one needs some magic USB driver too.<br /><br />But hey, if somebody else is fighting with PES files, here's a pointer to '<a href=\"http://git.kernel.org/?p=linux/kernel/git/torvalds/pesconvert.git;a=summary\">pesconvert</a>', my git source tree for that silly thumbnailer that created the above png. You'll need pnglib-devel and cairo-devel to compile it, but it's small and simple. And in case you wonder about the source PES file, it's <a href=\"http://brotheraccessories.com/HomeSewing/GetCreative/free-designs.aspx?PARAM=heart\">Jan_heartsdelight.pes</a>, a demonstration PES image from brother.","read":"0"},{"id":"43","feed_id":"1","title":"Finnish culture...","date":"2009-12-21 08:50:42.132","body":"It's not all that often that we encounter things from Finland here in Portland.  So imagine my surprise when we're on our way to our weekly date-night with Tove, and our baby-sitter is gushing about this adorable and wonderful Finnish YouTube video.. She apparently have been watching it three or four times a day for the last few days (weeks?), laughing hysterically.<br /><br />I'm intrigued by this notion, so I look it up, and notice that I am very late to an internet phenomenon. The thing in question is Armi &amp; Danny's <a href=\"http://www.youtube.com/watch?v=kA5GkLM5C7M\">\"I Want to Love You Tender\"</a>, which has apparently been a big hit on youtube for several years now.<br /><br />Now, people who aren't from Finland may not realize the whole <span style=\"font-style: italic;\">depth</span> of that video. To an outsider, it may look like some highschool musical number with particularly inept dancing. It's funny, yes, but you go on to watch keyboard cat and dramatic chipmunk.<br /><br />But to somebody from Finland, the first reaction is \"I recognize that tune\". The second reaction is \"Oh, it's <span style=\"font-style: italic;\">them</span>!\". That's not some inept highschool musical number, that's one of the most beloved Finnish entertainers <span style=\"font-style: italic;\">ever</span>! Ok, so the version you hear in Finland is in Finnish, and the above is the English version - and Finns back in the seventies weren't really all that good at English. That explains some of it.<br /><br />When I grew up, the Swedes had ABBA and Björn Borg. The Finns had Armi ja Danny. Really.<br /><br />Now I just find myself wishing that we'd have Finnish meal-pouches with musical accompaniments. \"Rudolf in a Bag\" MRE's (reindeer meat with lingonberries) with Armi and Danny on BluRay.<br /><br />Although I'm not sure I could take the concentrated awesomeness that is \"I Want to Love You Tender\" in glorious HD.  Maybe it's safer in that low-quality YouTube version.","read":"0"},{"id":"44","feed_id":"1","title":"WTF?","date":"2009-10-03 14:48:33.994","body":"So Tove is off learning how to judge Tae-Kwon-Do competitions, and the kids are roaming the neighborhood like jackals (or maybe they're upstairs reading a book. Who knows? I take a \"hands off\" approach to parenting).<br /><br />So I'm stalking the kitchen looking for food, my trusted canine companion by my side. My prey hides quietly on a remote shelf, but I outsmart the cardboard packaging easily (along with the NASA-designed internal metallic pouch), and am soon ready to feast on the guts of some random Indian lentil stew.<br /><br />And that's when it hits me.<br /><br />A quiet rattling emanates ominously from inside the nutritionally uninteresting outer shell as I'm about to discard it. I go on high alert, and ancient instincts immediately raise my adrenaline levels. What's going on?<br /><br />So I look inside, and in addition to the metallic pouch with the actual food, my meal has come with a CD full of (and I quote) \"Authentic Indian Cuisine\". No, wait! Underneath that it says \"Indian Classical Duets\".<br /><br />Which brings me to today's title: \"WTF?\" Have I been leading an unusually sheltered life, and this is actually normal? What's next? Happy Meals that come with Beyonce CD's?<br /><br />Now I'm intrigued, and considering going through our other indian ready-made meals. Was this a one-off? Or had I not just noticed before, and do all those $2.99 pre-made indian meal pouches come with these odd musical accompaniments?","read":"0"},{"id":"45","feed_id":"1","title":"Programming","date":"2009-08-09 13:07:49.364","body":"I've actually written code lately, although for some reason it's been all these stupid projects. First I needed to fix the kernel <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_0\">tty</span> <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_1\">refcounting</span>, then I got all <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_2\">OCD</span> on the git <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_3\">SHA</span>1 routines.<br /><br />I don't quite know why I wasted that much time on something as trivial as <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_4\">SHA</span>1 hashing, but it was kind of fun in a \"let's use the compiler as a glorified assembler\" kind of way. Some people seem to think that C is a real programming language, but they are sadly mistaken. It really is about writing almost-portable assembly language, and it turns out that getting good results from <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_5\">SHA</span>1 really is mostly about trying to fight the compilers tendency to try to be clever.<br /><br />So <a href=\"http://git.kernel.org/?p=git/git.git;a=blob;f=block-sha1/sha1.c;h=886bcf25e2f52dff239f1c744c11774af12da48a;hb=66c9c6c0fbba0894ebce3da572f62eb05162e547\">here</a> is the current result of me trying to get <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_6\">gcc</span> (well, arguably of it is mostly the C <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_7\">pre</span>-processor, rather than the compiler proper ) to generate good assembly code. On my <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_8\">Nehalem</span> machine (but not <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_9\">Netburst</span> or Atom - poor fragile micro-architectures that they are), it actually seems to outperform the <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_10\">OpenSSL</span> hand-written assembly language implementation.<br /><br />And once I get rid of <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_11\">libcrypt</span> from <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_12\">openssl</span>, I get rid of two silly <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_13\">runtime</span> loadable libraries that git no longer needs. And that in turn speeds up the test-suite by a couple of seconds.<br /><br />Did I mention that I seem to have some <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_14\">OCD</span> issues?","read":"0"},{"id":"46","feed_id":"1","title":"Parenting gold star (?)","date":"2009-07-14 08:47:34.022","body":"It's summer.<br /><br />Which in our family means summer camps.<br /><br />Oh, the kids are happy playing together, and we usually have one or two of the neighbors kids running around too, so it's not like they tend to get bored. But Tove is a big believer in making doubly sure that they don't go stir crazy around the house, so summer camps it is.<br /><br />Last week was <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_0\">Tae</span>-<span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_1\">Kwon</span>-Do camp (Tove is also a big believer in beating up other people), and apparently it was all fine. But what do I know - I wasn't interested in sports when I was small, I'm not interested in sports now either.<br /><br />And as part of their camp (presumably when they were taking a breather from trying to kill each other), they had to write a letter home about how they are thankful to their parents. Oh, those wacky Asian self-defense sports and their respect for their elders - another thing I don't seem to recall from my own childhood.<br /><br />Anyway, very cute. They all seem to be well on their path of writing pleasing prose, and I see a promising career of writing Hallmark cards (and made-for-TV shows) for all of them.<br /><br />Except possibly Celeste. There's a <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_2\">WTF</span> moment here:<br /><blockquote>You buy me lunch, breakfast and dinner. You bought me animals to play with so I could have a lot of fun in my life.</blockquote><span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_3\">Ok</span>, fine so far. She's a bit hung up on the \"buying\" part of this whole parenting gig, but hey,  she's just eight. She'll get over it, and if she doesn't, I guess she'll fit right into the culture. But then comes the kicker:<br /><blockquote>You also let me bury them instead of flushing them down the toilet.</blockquote>Ooh, yeah! That's some premium parenting there. Gold stars all around! It just makes me glow with pride.<br /><br />Of course, she has clearly forgotten about the fish. We did flush those.","read":"0"},{"id":"47","feed_id":"1","title":"Not-so-evil empire","date":"2009-07-12 17:13:00.458","body":"I'm usually not enamoured with the customer service of big companies, and you always tend to hear all the horror stories. But I want to give a shout-out to Comcast.<br /><br />Yeah, that Comcast. That same one that everybody loves to hate.<br /><br />I switched from DSL to cable a couple of days ago, mainly because I had been hoping for a long time for our phone company (Qwest, who I also have had nothing but good service from) to offer faster DSL speeds. And they never did. So I decided that I should look at the alternatives.<br /><br />I went for the \"professional install\" from Comcast, because I was pretty sure that our cable needed upgrading (it did).  And since I hate renting any electronics equipment in our house, so I was off to Fry's before-hand, and I got a Comcast-approved Linksys cable modem with built-in firewall ethernet and wireless router.<br /><br />Everything worked out fine, the installer was a few hours late, but he was friendly and knew what he was doing. He did say that he would have suggested going with a stand-alone modem and separate router box, but I've used Linksys routers before, so I wasn't too worried and liked the all-in-one box.  I was left with some temporary cable laid in our back yard, and it's probably going to be that way for a few weeks, but all in all, a good experience.<br /><br />Until later in the day, when the Linksys box rebooted.<br /><br />And then it did it again. And again. Roughly once an hour or so. It came up each time, but there was a very annoying 70-second pause in my internet connection each time. I had good statistics on exactly when it happened, and how long the internet was off-line, because I'd done some silly tools to keep track of that earlier when I had had DSL line trouble (due to just bad signal and constant retraining).<br /><br />In other words, it turns out that the cable installer was not just friendly and knew what he was doing, he really was right on the money. I don't know why, but that Linksys cable router is apparently total crap. And googling for it, I was clearly not the only one with the problem. It looks like you should avoid the WCG200v2 like the plague.<br /><br />I asked Comcast (email support, just to see how <span style=\"font-style: italic;\">that</span> works) whether they can upgrade the firmware of the thing, or can do anything about it, but they answered that they can't do anything about customer equipment. Hey, fair enough. Not their fault.<br /><br />So, like any self-respecting geek, I decided that I'll just buy more equipment, because let's face it, you can never have enough toys in your home. So off to Fry's I went again, and got myself a DOCSIS-3.0 motorola box and a separate Netgear router.<br /><br />Not only did I decide to avoid Linksys this time, but the Netgear one made a big deal about running open-source software, and I assume the \"L\" at the end of the name means that the open-source in question is Linux. Sure, Linksys had a Linux router too (with a penguin!) but let's face it, they screwed up, so I'm giving the competition a go this time.<br /><br />So I need to provision it (ie letting Comcast know about the new modem MAC address), so I call up Comcast. It being a Sunday afternoon, I was expecting <span style=\"font-style: italic;\"><span style=\"font-style: italic;\"></span></span>that I'll just have to wait for Monday to get it sorted out. But no, not only is there a friendly tech who is greeting me with neither silly muzak nor waiting, but she's happy to get my all provisioned and up and running with a new cable modem in minutes (ok, so it took more than a couple of minutes, but a lot of it was literally waiting for the new cable box to boot up a few times).<br /><br />And so far, the new box isn't rebooting constantly whenever there's more than a few internet connections going on. Which is just as well, since it clearly does take longer to boot than the old one. Knock wood.<br /><br />So what can I say? Friendly competence all around.  Good for Comcast. And a big black eye for Linksys.","read":"0"},{"id":"48","feed_id":"1","title":"Pathetic","date":"2009-07-04 15:17:29.856","body":"It's the 4<span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_0\">th</span> of July, the kids are out playing, Tove's at the mall, and I'm following my new toy as it crawls across the map of the US towards me, courtesy of UPS tracking and google maps.<br /><br />This fall, we'll go for two scuba trips: in addition to our yearly week in Hawaii, Tove is treating me to a week in Belize. Because I only turn 40 once, I'm told. Little does she know that if that trip turns out successful, I'm planning on turning forty the year after too!<br /><br /><span style=\"font-style: italic;\">Anyway</span>. In preparation of all this, my new toy is a dive computer, and it should arrive in a few days. I always just rent all my gear, and as a result on some dives I then end up following the dive master like a dog on a leash because I don't carry my own computer. The divers who know what they are doing always like feeling like everybody keeps track of their own nitrogen levels.<br /><br />But I will be leashed no more. <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_1\">Paraphrasing</span> <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_2\">Braveheart</span>: \"They may paint my butt blue, but they'll never take <span style=\"font-style: italic;\">our Freedom</span><span style=\"font-style: italic;\"></span>\". Or something like that. I never actually saw the movie.<br /><br />Of course, the trips are months away, and in the meantime I'll just have to amuse myself by taking long baths with my toy. Once it arrives. I may be turning 40, but that doesn't mean I can't act like a little child. I may not live the dream, but I can dream the life.<br /><br />Am also considering taking a <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_3\">Nitrox</span> course. Just because. Because that way I'll have more buttons I can press, and modes I can set, on my new toy. Anybody got suggestions on places that do that around Portland?","read":"0"},{"id":"49","feed_id":"1","title":"Outwitting the fashion police","date":"2009-06-17 15:33:14.707","body":"This is a public service announcement for all geeks.<br /><br />Are you tired of people pointing out that you shouldn't use socks and sandals? I know, it really annoyed me too. It's like they are trying to take away your geek card.<br /><br />But there's a solution.<br /><br />For a year now, I've been avoiding the fashion police by instead of \"sandals\" wearing \"shoes with holes in their sides\". I've got these Keen's that look enough like shoes that nobody ever bats an eye at you wearing them with socks (Ok, by \"nobody\", I mean my wife, but that's all that matters, right?).<br /><br />The problem is that it looks like the fashion police may be starting to figure it out. The model I have seems to be no longer in production, and now all the new ones I find are pretty obviously sandals (toes and/or heel showing).<br /><br />So when I wear out my current ones, I'm going to be in trouble again.  Damn.","read":"0"},{"id":"50","feed_id":"1","title":"Happiness is a warm SCM","date":"2009-06-11 13:56:55.997","body":"I'll have to post this while I'm still happy, because the merge window for Linux 2.6.31 opened a day ago (well, somewhat more, but I don't take patches immediately after doing a release), and so far it's been such a nice thing that I thought I'd better post while in a good mood.  Before somebody sends me the merge request from hell.<br /><br />So why am I in a good mood?<br /><br />My real \"work\" is not really writing code any more, and hasn't been for a long time. No, I worry most about the whole \"flow of patches\", and the way development happens, rather than so much about any individual piece of code I maintain. And the last few release cycles have had a couple of really hard-to-merge issues - not because the code was necessarily bad, but because of how it was then presented to me as a fairly messy history.<br /><br />And so far, the 2.6.31 merge window is going swimmingly. The x86 tree, which has gone through a yo-yo of different development models with (different) problems, seems to have gotten to that \"good place\" where it seems to be working.<br /><br />Part of the problem is that 'git' is such a flexible tool that you can use it in various modes, and mix things up freely. The whole distributed nature means that there's no gatekeeper, you can do whatever you want. And the flexibility and power is good, but it does mean that it's also easy to make a mess of it - the old UNIX philosophy of giving people rope, and letting them hang themselves with it if they want to.<br /><br />So it takes time for people (me included) to learn the rules that work. And it seems people are learning. And that feels really good.","read":"0"},{"id":"51","feed_id":"1","title":"Yet more reading","date":"2009-05-28 13:44:06.517","body":"Somebody in the comments wondered how I have time to read so much.. Part of it is simply that reading is my only real hobby (scuba? Sure - one week a year. Reading? 51 weeks a year).  So I literally spend my time either in front of my computer or reading - and I don't waste it on commuting.<br /><br />Another part obviously ends up being that I'm just a fast reader. Oh, I know people who read faster, but if it's some easily read sci-fi or fantasy, I'll read at a pace of 100-150 pages per hour, and you simply <span style=\"font-style: italic;\">cannot</span> distract me while I'm reading. Try to talk to me, and I won't hear a word.<br /><br />So most books I finish in a single sitting, and weekends I might read two books in a day. The more sciency books I read take longer, but that may explain why I probably average about three books per week, and sometimes do many more - especially during the later parts of the merge window when things aren't as hectic on the kernel front.<br /><br />Anyway, the haul over the last couple of weeks has been mostly random stuff (<span style=\"font-style: italic;\">Fire Upon the Deep</span> by Vernon Vinge, <span style=\"font-style: italic;\">Golden Torc</span> by Simon Green, <span style=\"font-style: italic;\">Turn Coat</span> by Jim Butcher, <span style=\"font-style: italic;\">The Laurentine Spy</span> by Emily Gee). Don't ask me what the common thread is, because there is none.  Some were randomly picked up from the book store in desperation over not having anything at all to read, others were things I'd read the authors before. I enjoyed them all, in different ways.<br /><br />On the non-fluff front, I read <span style=\"font-style: italic;\">Phantoms int he Brain</span> by V.S. Ramachandran, based on a recommendation in the comments of the last reading post. I have to say, it is a better book than <span style=\"font-style: italic;\">The Brain that Changes Itself</span> (the one that triggered the recommendation), but at the same time I was also a bit disappointed with it.<br /><br />Why? All the chapters on different disorders were absolutely fascinating, but then the last chapter just stood out as a big disappointment. It seems that any time that people start discussing \"qualia\" and guessing about what consciousness is, otherwise sane and coherent people end up being just confused and crazy (example: Roger Penrose). Ramachandran avoids the outright crazy, but chapter 12 ended up being a big disappointment to an otherwise engrossing book for me. But even that disappointing chapter had interesting content in it.<br /><br />So, highly recommended, despite the small nagging feeling that the last chapter really could have been so much better. Most of the book is about the fascinating ways the brain fails at what it's supposed to do, and what it teaches us about how people really function.<br /><br />The other non-fluff book was Bart Ehrman's <span style=\"font-style: italic;\">\"Jesus Interrupted\"</span>, a kind of follow-up to the earlier <span style=\"font-style: italic;\">Misquoting Jesus</span> that I read some time ago. Bible study is actually fairly interesting, although in many ways I always thought the Old Testament was way more interesting. Ehrman, of course, concentrates pretty much exclusively on just the New Testament, with just passing mention of OT issues as they relate to NT issues. The book was also the inspiration for the current kernel naming (\"Man-Eating Seals of Antiquity\"), since it fit perfectly with my pattern of nonsensical animal-related naming scheme.<br /><br />Recommended. Not nearly as engrossing as <span style=\"font-style: italic;\">Phantoms</span>, but an interesting read none-the-less.","read":"0"},{"id":"52","feed_id":"1","title":"Memorial day BBQ","date":"2009-05-26 16:06:31.804","body":"<a onblur=\"try {parent.deselectBloggerImageGracefully();} catch(e) {}\" href=\"http://3.bp.blogspot.com/_E2tJnrV_I64/Shx0i5V1pvI/AAAAAAAAABs/bG8aBm0fULE/s1600-h/limitations.jpg\"><img style=\"margin: 0px auto 10px; display: block; text-align: center; cursor: pointer; width: 320px; height: 268px;\" src=\"http://3.bp.blogspot.com/_E2tJnrV_I64/Shx0i5V1pvI/AAAAAAAAABs/bG8aBm0fULE/s320/limitations.jpg\" alt=\"\" id=\"BLOGGER_PHOTO_ID_5340271401011357426\" border=\"0\" /></a>I've always liked the demotivational posters from despair.com a lot more than those inane motivational ones.  And this one obviously hits close to home.<br /><br />So what do our neighbors bring with them when we invite them for a BBQ? Yup.<br /><br />Do my friends know me or what? Of course, my favourite is probably the one that says something like \"The point of your life may be just to act as a warning to others\", but that one doesn't have penguins.<br /><br />The downside to actually finally having the physical thing, of course, is that I'm not much for hanging things up. So it will probably end up propped up in my office somewhere, adding to the general messiness.","read":"0"},{"id":"53","feed_id":"1","title":"More reading..","date":"2009-05-11 18:34:44.256","body":"So in between testing -rc5 on all the machines I can find (and in the process being a total PITA when I find just configuration idiocies and a random \"my wireless doesn't work - oh, wait, yes it does\"), I've been reading more.<br /><br />And yes, I finished off the Soldier Son trilogy. And yes, Nevare was fat and stupid and whiny, up until the last chapter. Oh well. Not unexpected.<br /><br />On the positive front, there's \"<span style=\"font-style: italic;\">Why Evolution is True</span>\" by<span> Jerry A Coyne.<br /><br />I'm not quite sure who this book is for (the people denying evolution certainly don't have enough braincells or background to read it), but I suspect that if you're sitting on the fence, and want to educate yourself, but have been talking too much to people who tell you that evolution can't be true because [ insert some odd reason here] then this might be the book for you.<br /><br />It's a pretty good read, with a lot of examples from different areas. It made me think that I'll be really happy to give this book to the kids when they are ready for it, which is probably not for a few years, but still..<br /><br />Currently reading \"<span style=\"font-style: italic;\">The Brain that Changes Itself</span>\" by Norman Doidge. I have no idea where that book came from, but Tove claims I bought it. So it must be so. I clearly buy too many books, and some of them get forgotten and then found again. It's like a mild case of Alzheimer's - every day is a new adventure.<br /><br />Anyway, I got sidetracked there a bit: the book started out like some crazy persons rant against the \"establishment\", and I was sure I could not possibly have bought it, and Tove had decided that it was time to get me to read some odd new-age literature. But once you get past the preface, and get over the point where Norman claims that brain plasticity is somehow a radical new thing, the book actually is quite interesting.<br /><br />Ok, so I'm only about two-thirds through, and parts of it really do seem to be a bit too overly excited and over-hyped (and read as a commercial for some of the things mentioned), but I've been enjoying it. I suspect there are much more balanced accounts out there, but with the caveat that you should probably read this book with a healthy dose of critical thinking, it's been a good read.<br /></span>","read":"0"},{"id":"54","feed_id":"1","title":"Reading: Evil Genes","date":"2009-05-06 09:38:35.282","body":".. by Barbara Oakley.<br /><br />I have to say that I was a bit disappointed in the lack of any actual science (it starts out much more promising than it then ends up being).<br /><br />But that disappointment is balanced by the fact that it was actually a fun read, mostly because you end up trying to match some of the traits being discussed to yourself, your crazy relatives, your psychotic co-workers etc.<br /><br />So I'd say that it ended up having not a lot about genes, and a lot of armchair psychology  of people Barbara never actually met (apart from her sister). But I'll still have to give it a thumbs up just for being entertaining.<br /><br />The merge window is calming down, so I've been reading other things too, but they've been eminently forgettable. I'm now steeling myself to begin \"Renegade's Magic\", the third installment of Robin Hobb's Soldier Son trilogy. The two first ones were big disappointments, and I had already decided that I'm not even going to bother finishing the trilogy, but I guess I can't.<br /><br />Here's to hoping  Nevare turns out to be less of a fat whining idiot in the third book. But I'm not really holding my breath.","read":"0"},{"id":"55","feed_id":"1","title":"Peeve of the day","date":"2009-05-04 10:06:27.133","body":"<span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_0\">Ok</span>, so I have <span style=\"font-style: italic;\">lots</span> of pet peeves, and if I wanted to blog them all I'd have no time for anything else (and a lot more blog posts than the occasional one), but this one struck me the other day.<br /><br />I was at the optometrist with Patricia, who is near-sighted like me. Or rather - not like me, since I've had <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_1\">lasik</span>, and since she's more nearsighted than I ever was. She's blind as a bat without glasses or contacts, in other words.<br /><br />Also like me, she's allergic to pollen. She gets itchy, watery eyes. So at the optometrist, when they ask about whether she's had problems with her eyes, the allergies come up. And what do you know, they have eye-drops for that.<br /><br /><span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_2\">Ok</span>, not surprising. But what I <span style=\"font-style: italic;\">do</span> find surprising is the kind of eye-drops they have. This is a doctor's office, you'd expect them to be professional. But their eye-drops are homeopathic, and the doctor talks them up as not having any harsh medication in them. Well, duh! They're saline solution.<br /><br />So I sit there quietly, and don't call him out for being a quack, because real doctors do actually prescribe placebos, and maybe he does know better. And there's also no question that plain saline solution isn't a fine thing to use when your eyes are itchy.<br /><br />So afterwards, I spend some time afterwards talking to Patricia about placebos and homeopathy and quackery, in my never-ending hope that my kids won't grow up to be morons. But it's been a few days, and quite frankly, it still disturbs me. I've not had any other issues with that optometrist, but I'm seriously wondering if this is worth switching eye doctors over.<br /><br />Do I want somebody who sells snake-oil (<span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_3\">ok</span>, so he gave a free sample, and no way would I have paid for it anyway) looking at my kids eyes? Even if it's harmless and even beneficial?<br /><br />I'd much rather have seen free samples of \"sterile saline solution\". And oh yes, please feel free to make a big deal out of the \"sterile\" part, and feel free to talk about how it is \"all natural\" and free of <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_4\">Tetrahydrozoline</span> or other chemicals.<br /><br />But this piece-of-crap saline solution talked about the magical homeopathic \"active ingredients\" (non-existent and bogus), and while it did list the \"inactive ingredients\" (<span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_5\">ie</span> water and sodium chloride - aka \"saline solution\"), it was basically a huge advert for teaching people bad science and paying extra for it.<br /><br />And I'm not crazy. I'm not going to make my own saline solution to save money. I'll happily pay extra for \"sterile\". I'll pay extra for nice prepared droppers in tiny sizes, even if it means you pay actual money for just tiny amounts of water with some table salt in it (no iodine - get the \"kosher\" salt if you want to make your own, and use distilled water).  I'll happily pay for the convenience of having somebody else prepare saline solution of the proper strength and in a convenient package.<br /><br />And the funny thing is, I don't mind it when I see the same thing at the checkout counter in the organic grocery store I prefer to go to. I <span style=\"font-style: italic;\"></span>go there because quite frankly, the average meat department in something like a Safeway or <span class=\"blsp-spelling-error\" id=\"SPELLING_ERROR_6\">Albertsons</span> leaves a lot to be desired. And hey, it's an organic store, so I kind of <span style=\"font-style: italic;\">expect</span> it to then cater to the ignorant and the crack-pots too.<br /><br />But at the doctors' office?","read":"0"}]}